<p-growl [(value)]="msgs" (onHover)="clear()" life="30000"></p-growl>
<div class="busqueda-container">
  <!--DATOS GENERALES-->
  <div class="card">
    <div class="card-header header-ficha" (click)="abreCierraFicha()">
      <div *ngIf="!openFicha" class="form-row">
        <div class="col-lg-1 col-md-2">
          <div class="img-colegiado">
            <i *ngIf="!existeImagen" class="fa fa-user icon-ficha"></i>
            <img *ngIf="existeImagen" [src]="imagenPersonaJuridica" class="icon-ficha">
          </div>
        </div>
        <div class="col-lg-11 col-md-10">
          <div class="d-flex justify-content-start mb-1">
            <label class="mr-auto title-ficha">{{ "general.message.datos.generales" | translate}}</label>
            <!--<label class="registros-ficha">(0 registros)</label>-->
          </div>
          <div class="d-flex justify-content-between">
            <label>{{"censo.fichaCliente.literal.identificacion" | translate}}
              <span>{{body.nif}}</span>
            </label>
            <label>{{"censo.busquedaClientesAvanzada.literal.tipoCliente" | translate}}
              <span>{{body.tipo}}</span>
            </label>
            <label>{{"administracion.usuarios.literal.fechaAlta" | translate}}
              <span>{{body.fechaConstitucion}}</span>
            </label>
            <label>{{"censo.consultaDatos.literal.fechaBaja" | translate}}
              <span>{{body.fechaBaja}}</span>
            </label>
            <label>{{"censo.consultaDatosGenerales.literal.denominacion" | translate}}
              <span>{{body.denominacion}}</span>
            </label>
            <label>{{"gratuita.definirTurnosIndex.literal.abreviatura" | translate}}
              <span>{{body.abreviatura}}</span>
            </label>
            <i *ngIf="!openFicha" class="fa fa-angle-down float-right"></i>
          </div>
        </div>
      </div>
      <div *ngIf="openFicha" class=" header-ficha-open d-flex justify-content-start align-items-center">
        <div class="img-colegiado">
          <i *ngIf="!existeImagen" class="fa fa-user icon-ficha"></i>
          <img *ngIf="existeImagen" [src]="imagenPersonaJuridica" class="icon-ficha">
        </div>
        <label class="title-ficha">{{ "general.message.datos.generales" | translate}}</label>
        <i class="fa fa-angle-up ml-auto"></i>
      </div>
    </div>
    <!--cuerpo datos generales-->

    <div *ngIf="openFicha" class="card-body card-body-ficha">
      <div class="row">
        <div class="bloque col-lg-2 col-md-3 col-sm-3 p-2">
          <div class="img-colegiado text-center my-0 mx-auto">
            <i *ngIf="!existeImagen" class="fa fa-user" style="font-size:6.5rem;color:grey"></i>
            <img *ngIf="existeImagen" [src]="imagenPersonaJuridica">
            <p-fileUpload #fubauto chooseLabel="" class="edit my-0 mx-auto main-button" mode="basic" name="file" auto="true" accept="image/*"
              (change)="uploadImage($event)" auto="true">
            </p-fileUpload>
          </div>
        </div>
        <!-- <div class="bloque col-lg-2 col-md-3 col-sm-3 p-2">
          <div class="form-row">
            <div class="form-group col-lg-8 col-md-8 my-0 mx-auto">
              <div class="text-center img-colegiado my-0 mx-auto">
                <i *ngIf="!existeImagen" class="fa fa-user" style="font-size:6.5rem;color:grey"></i>
                <img *ngIf="existeImagen" [src]="imagenPersonaJuridica" class="imagenCentrada">
                <p-fileUpload [(disabled)]="camposDesactivados" #fubauto name="file" mode="basic" (change)="uploadImage($event)" auto="true"
                  styleClass="pi pi-pencil" class="main-button my-0 mx-auto edit" chooseLabel=""></p-fileUpload>
              </div>
            </div>
          </div>
        </div> -->
        <div class="bloque col-lg-6 col-md-5 col-sm-5">
          <div class="form-row">
            <div class="form-group col-lg-6 col-md-6">
              <label>{{"censo.fichaCliente.literal.identificacion" | translate}} (*)</label>
              <input [(ngModel)]="body.nif" type="text" class="form-control" (ngModelChange)="onChangeForm()" [disabled]="!editar || disabledAction" pInputText>
              <div *ngIf="identificacionValida == false">
                <label class="labelError">{{"El cif es inválido"}}</label>
              </div>
            </div>
            <div *ngIf="editar" class="form-group col-lg-6 col-md-6">
              <label>{{"censo.busquedaClientesAvanzada.literal.tipoCliente" | translate}} (*)</label>
              <p-dropdown class="select-form" [(ngModel)]="selectedTipo" [options]="comboIdentificacion" optionLabel="label" (ngModelChange)="getTipo($event)"
                [disabled]="true"></p-dropdown>
            </div>
            <div *ngIf="!editar" class="form-group col-lg-6 col-md-6">
              <label>{{"censo.busquedaClientesAvanzada.literal.tipoCliente" | translate}} (*)</label>
              <input [(ngModel)]="comboTipo[0]" type="text" class="form-control" (ngModelChange)="onChangeForm()" [disabled]="true" pInputText>
            </div>
            <div class="form-group col-lg-6 col-md-6 form-group-date">
              <label>{{"administracion.usuarios.literal.fechaAlta" | translate}} (*)</label>
              <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1930:2050" [locale]="es" [(ngModel)]="body.fechaConstitucion"
                (ngModelChange)="onChangeForm()" dateFormat="dd/mm/yy" icon="far fa-calendar-alt" showIcon="true" [(disabled)]="!editar || disabledAction"></p-calendar>
            </div>
            <div class="form-group col-lg-6 col-md-6 form-group-date">
              <label>{{"censo.consultaDatos.literal.fechaBaja" | translate}}</label>
              <!-- <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1930:2050" [locale]="es" [(ngModel)]="body.fechaBaja"
                (ngModelChange)="onChangeForm()" dateFormat="dd/mm/yy" icon="far fa-calendar-alt" showIcon="true" [disabled]="true"></p-calendar> -->
              <input [(ngModel)]="body.fechaBaja" dateFormat="dd/mm/yy" [disabled]="true" [style]="{ 'position': 'relative', 'z-index': '1000' }"
                type="text" class="form-control" (ngModelChange)="onChangeForm()" pInputText>
            </div>
            <div class="form-group col-lg-6 col-md-6">
              <label>{{"censo.consultaDatosGenerales.literal.denominacion" | translate}} (*)</label>
              <input [(ngModel)]="body.denominacion" type="text" class="form-control" (ngModelChange)="onChangeForm()" [(disabled)]="camposDesactivados || disabledAction"
                [maxLength]="99" pInputText>
            </div>
            <div class="form-group col-lg-6 col-md-6">
              <label>{{"gratuita.definirTurnosIndex.literal.abreviatura" | translate}} (*)</label>
              <input [(ngModel)]="body.abreviatura" type="text" class="form-control" (ngModelChange)="onChangeForm()" [(disabled)]="camposDesactivados || disabledAction"
                [maxLength]="100" pInputText>
            </div>
            <!--<div class="form-row p-1 col-lg-6 col-md-6">
              <div class="col-lg-12 col-md-12">
                <label>{{"censo.consultaDatosRegistrales.literal.numRegistro" | translate}} (*)</label>
              </div>
              <div class="form-group col-lg-4 col-md-4 pr-0">
                <input [(ngModel)]="body.prefijoNumsspp" type="text" class="form-control" [(disabled)]="prefijoBlock" pInputText>
              </div>
              <div class="form-group col-lg-4 col-md-4 pr-0">
                <input [(disabled)]="camposDesactivados" [(ngModel)]="body.contadorNumsspp" type="text" class="form-control" pInputText (input)="compruebaRegistro()">
                <div *ngIf="contadorNoCorrecto == true">
                  <label class="labelError">{{"censo.ws.literal.soloNumeros" | translate}}</label>
                </div>
              </div>
              <div class="form-group col-lg-4 col-md-4 pr-0">
                <input [(disabled)]="camposDesactivados" [(ngModel)]="body.sufijoNumsspp" type="text" class="form-control" pInputText>
              </div>
          </div>-->
          </div>
        </div>
        <!-- INFORMACIÓN ADICIONAL -->
        <div class="bloque col-lg-4 col-md-4">
          <div class="form-row">
            <div class="form-group col-lg-12 col-md-12">
              <label>{{"censo.fichaCliente.situacion.idiomaPref" | translate}} (*)</label>
              <p-dropdown class="select-form" [options]="idiomas" [(disabled)]="camposDesactivados || disabledAction" [(ngModel)]="idiomaPreferenciaSociedad"
                [filter]="true" (ngModelChange)="onChangeForm()" filterBy="label"></p-dropdown>
            </div>
            <div class="form-group col-lg-12 col-md-12">
              <label>{{"censo.consultaDatosGenerales.literal.cuentaContable" | translate}}</label>
              <input type="text " class="form-control " [(disabled)]="camposDesactivados || disabledAction" [(ngModel)]="body.cuentaContable" [maxLength]="20"
                (ngModelChange)="onChangeForm()" pInputText>
            </div>
            <div class="form-group col-lg-12 col-md-12">
              <label>{{"censo.general.literal.anotaciones" | translate}}: </label>
              <textarea pInputTextarea [(ngModel)]="body.anotaciones" [(disabled)]="camposDesactivados || disabledAction" (ngModelChange)="onChangeForm()"
                [maxLength]="2000"></textarea>
            </div>
            <div class="form-group col-lg-12 col-md-12">
              <label>{{"menu.administracion.gestionMultiidioma.etiquetasSociedad" | translate}}
                <i class="fa fa-plus" style="color:grey" (click)="habilitarAutocompletar($event)"></i>
              </label>

              <br>

              <p-autoComplete #auto [(ngModel)]="etiquetasPersonaJuridicaSelecionados" [suggestions]="comboEtiquetas" (completeMethod)="filterLabelsMultiple($event)"
                [minLength]="1" field="label" [multiple]="true" (onKeyUp)="onKeyUp($event)" (onSelect)="onSelect($event)" (onUnselect)="onUnselect($event)"
                [disabled]="!autocompletar || disabledAction" [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}">
                <ng-template let-etiquetasPersonaJuridicaSelecionados pTemplate="selectedItem">
                  <div *ngIf="etiquetasPersonaJuridicaSelecionados.backgroundColor != ''" class="ui-autocomplete-multiple-container ui-widget ui-inputtext ui-corner-all ng-star-inserted li"
                    [ngStyle]="{'background': etiquetasPersonaJuridicaSelecionados.backgroundColor}" (click)="onClick($event, etiquetasPersonaJuridicaSelecionados)">
                    {{ etiquetasPersonaJuridicaSelecionados.label }}
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>
          </div>
        </div>
      </div>
      <br>

    </div>
    <!--END DATOS GENERALES-->
    <div *ngIf="openFicha" class="card-footer ">
      <div class="text-right main-button ">
        <button (click)="restablecer()" [(disabled)]="camposDesactivados || disabledAction" pButton type="button" icon="fa fa-undo" iconPos="left"
          label="{{ 'general.boton.restablecer' | translate}}"></button>
        <button (click)="comprobarAuditoria()" [(disabled)]="!showGuardar || disabledAction" pButton type="button" icon="far fa-save" iconPos="left"
          label="{{ 'general.boton.guardar' | translate}}"></button>
      </div>
    </div>
  </div>

  <!-- CREAR ETIQUETA -->
  <p-dialog #dialog [(visible)]="checked" responsive="true" [draggable]="false" modal="modal" resizable="false" [minHeight]="500"
    [minWidth]="500">
    <p-header class="title">
      <label>{{ mensaje }}</label>
    </p-header>

    <div class="bloque col-lg-12 col-md-12">
      <div class="row">

        <!-- DESHABILITA EL FOCO  -->
        <span class="ui-helper-hidden-accessible">
          <input type="text" />
        </span>

        <div class="form-group col-lg-6 col-md-6">
          <label *ngIf="historico">{{"administracion.auditoriaUsuarios.fechaDesde" | translate}}</label>
          <label *ngIf="!historico">{{"administracion.auditoriaUsuarios.fechaDesde" | translate}} (*)</label>
          <p-calendar [monthNavigator]="true" [yearNavigator]="true"  [(ngModel)]="item.fechaInicio" [locale]="es"
            [utc]="true" icon="far fa-calendar-alt" dateFormat="dd/mm/yy" showIcon="true" (ngModelChange)="validateFields()"
            [(disabled)]="historico" [(maxDate)]="fechaHoy"></p-calendar>
        </div>

        <div class="form-group col-lg-6 col-md-6 form-group-date">
          <label *ngIf="historico">{{"administracion.auditoriaUsuarios.fechaHasta" | translate}}</label>
          <label *ngIf="!historico">{{"administracion.auditoriaUsuarios.fechaHasta" | translate}} (*)</label>
          <p-calendar [monthNavigator]="true" [yearNavigator]="true"  [(ngModel)]="item.fechaBaja" [locale]="es"
            [utc]="true" icon="far fa-calendar-alt" dateFormat="dd/mm/yy" showIcon="true" (ngModelChange)="validateFields()" [(minDate)]="fechaHoy"
            [(disabled)]="historico"></p-calendar>
          <div *ngIf="item.fechaBaja != null && !isFechaBajaCorrect && !historico">
            <label class="labelError">{{"gratuita.altaTurnos.error.fechaBajaPosteriorInicio" | translate}}</label>
          </div>
        </div>
      </div>
    </div>

    <p-footer *ngIf="!historico">
      <div class="text-right main-button">
        <button (click)="aceptDialogConfirmation(item)" pButton type="button" icon="fa fa-check" iconPos="left" label="{{ 'general.boton.submit' | translate}}"
          [disabled]="!isTrue"></button>
        <button (click)="closeDialogConfirmation(item)" pButton type="button" icon="fa fa-close" iconPos="left" label="{{ 'general.boton.cancel' | translate}}"></button>
      </div>
    </p-footer>
  </p-dialog>

  <!-- AUDITORIA -->

  <p-dialog [(visible)]="displayAuditoria" responsive="true" [draggable]="false" modal="modal" resizable="false" [minHeight]="500"
    [minWidth]="500">
    <p-header class="title">
      <label>{{"general.ventana.cgae" | translate}} -{{"censo.consultaHistorico.cabecera" | translate}}</label>
    </p-header>

    <div class="bloque col-lg-12 col-md-12">
      <div class="row">
        <div class="form-group col-lg-12 col-md-12">
          <label>{{"censo.datosHistorico.literal.motivo" | translate}} (*)</label>
          <textarea pInputTextarea [(ngModel)]="body.motivo" (ngModelChange)="comprobarCampoMotivo()"></textarea>
        </div>
      </div>
    </div>
    <p-footer>
      <div class="text-right main-button ">
        <button (click)="cerrarAuditoria()" pButton type="button" icon="fa fa-close" iconPos="left" label="{{ 'general.boton.close' | translate}}"></button>
        <button (click)="guardar()" [disabled]="!showGuardarAuditoria" pButton type="button" icon="fa fa-save" iconPos="left" label="{{ 'general.boton.guardarCerrar' | translate}}"></button>
      </div>
    </p-footer>
  </p-dialog>

  <div *ngIf="progressSpinner" class="overlay-spinner">
    <div class="loader"></div>
  </div>