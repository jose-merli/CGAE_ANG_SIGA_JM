<p-growl [(value)]="msgs" (onHover)="clear()" life="30000"></p-growl>

<div class="busqueda-container">
  <div class="header-title">
    <i class="fa fa-square"></i>
    <p>{{"menu.censo" | translate}}
      <i class="fa fa-angle-right"></i> {{'menu.censo.buscarSociedades' | translate}}
      <i class="fa fa-angle-right"></i>{{"gratuita.operarEJG.literal.datosIntegrantes" | translate}}</p>
  </div>
  <div class="card">
    <div class="card-header header-ficha">
      <div *ngIf="!esFichaActiva('identificacion')" class="form-row">
        <div class="col-lg-1 col-md-2">
          <div class="img-colegiado" (click)="abrirFicha('identificacion')" >
            <i class="fa fa-users icon-ficha"> </i>
          </div>
        </div>
        <div class="col-lg-11 col-md-10">
          <div class="d-flex justify-content-start mb-1" (click)="abrirFicha('identificacion')" >
            <label class="mr-auto title-ficha">{{"censo.busquedaClientes.literal.datosIdentificacion" | translate}}</label>
          </div>
          <div class="d-flex justify-content-between">
            <label>{{"administracion.usuarios.literal.NIF" | translate}}
              <span>{{ body.nifCif }}</span>
            </label>
            <label>{{"administracion.parametrosGenerales.literal.nombre" | translate}}
              <span>{{ body.nombre }}</span>
            </label>
            <label>{{"censo.busquedaClientes.literal.apellido1" | translate}}
              <span>{{ body.apellidos1 }}</span>
            </label>
            <label>{{"censo.busquedaClientes.literal.apellido2" | translate}}
              <span>{{ body.apellidos2 }} </span>
            </label>
            <i [ngClass]="{ 'fa fa-angle-up': openFicha, 'fa fa-angle-down': !openFicha} "></i>
          </div>
        </div>
      </div>
      <div *ngIf="esFichaActiva('identificacion')" (click)="abrirFicha('identificacion')" class=" header-ficha-open d-flex justify-content-start align-items-center">
        <div class="img-colegiado" (click)="abrirFicha('identificacion')" >
          <i class="fa fa-users icon-ficha"> </i>
        </div>
        <label (click)="abrirFicha('identificacion')" class="title-ficha">{{"censo.busquedaClientes.literal.datosIdentificacion" | translate}}</label>
        <i (click)="abrirFicha('identificacion')" class="fa fa-angle-up ml-auto"></i>
      </div>
    </div>

    <!--cuerpo datos identificacion-->

    <div *ngIf="esFichaActiva('identificacion')" class="card-body card-body-ficha">
      <div class="row">
        <div class="form-group col-lg-3 col-md-6">
          <label>{{"administracion.usuarios.literal.NIF" | translate}} (*)</label>
          <input type="text" class="form-control" [(ngModel)]="body.nifCif" [(disabled)]="isDisablednifCif || disabledAction" pInputText>
        </div>
        <div class="form-group col-lg-3 col-md-6">
          <label>{{"administracion.parametrosGenerales.literal.nombre" | translate}} (*)</label>
          <input type="text" class="form-control" [(ngModel)]="body.nombre" [(disabled)]="isDisabledNombre || disabledAction" pInputText>
        </div>
        <div class="form-group col-lg-3 col-md-6">
          <label>{{"censo.busquedaClientes.literal.apellido1" | translate}} (*)</label>
          <input type="text" class="form-control" [(ngModel)]="body.apellidos1" [(disabled)]="isDisabledApellidos1 || disabledAction"
            pInputText>
        </div>
        <div class="form-group col-lg-3 col-md-6">
          <label>{{"censo.busquedaClientes.literal.apellido2" | translate}}</label>
          <input [(ngModel)]="body.apellidos2" type="text" class="form-control" [(disabled)]="isDisabledApellidos2 || disabledAction"
            pInputText>
        </div>
      </div>
      <br>

      <!--END DATOS GENERALES-->
    </div>
  </div>

  <!-- COMIENZA COLEGIACION -->

  <div class="card">
    <div class="card-header header-ficha">
      <div *ngIf="!esFichaActiva('colegiacion')" class="form-row">
        <div class="col-lg-1 col-md-2">
          <div class="img-colegiado" (click)="abrirFicha('colegiacion')">
            <i class="fa fa-users icon-ficha"> </i>
          </div>
        </div>
        <div class="col-lg-11 col-md-10">
          <div class="d-flex justify-content-start mb-1" (click)="abrirFicha('colegiacion')">
            <label  class="mr-auto title-ficha">{{"censo.busquedaClientes.literal.datosColegiacion" | translate}}</label>
          </div>
          <div class="d-flex justify-content-between">
            <label>{{"censo.busquedaClientesAvanzada.literal.tipoColegio" | translate}}
              <span>{{ descripcionTipoColegio.label }}</span>
            </label>
            <label>{{"censo.datosDireccion.literal.provincia" | translate}}
              <span>{{ descripcionProvincia.label }}</span>
            </label>
            <label>{{"censo.resultadoDuplicados.numeroColegiado" | translate}}
              <span>{{ body.numColegiado }}</span>
            </label>
            <i (click)="abrirFicha('colegiacion')" [ngClass]="{ 'fa fa-angle-up': openFicha, 'fa fa-angle-down': !openFicha} "></i>
          </div>
        </div>
      </div>
      <div *ngIf="esFichaActiva('colegiacion')" (click)="abrirFicha('colegiacion')" class=" header-ficha-open d-flex justify-content-start align-items-center">
        <div class="img-colegiado" (click)="abrirFicha('colegiacion')">
          <i class="fa fa-users icon-ficha"> </i>
        </div>
        <label (click)="abrirFicha('colegiacion')" class="title-ficha">{{"censo.busquedaClientes.literal.datosColegiacion" | translate}}</label>
        <i (click)="abrirFicha('colegiacion')" class="fa fa-angle-up ml-auto"></i>
      </div>
    </div>

    <!--COMIENZO COLEGIACION-->

    <div *ngIf="esFichaActiva('colegiacion')" class="card-body card-body-ficha">


      <div class="row">
        <div class="form-group col-lg-3 col-md-6">
          <label>{{"censo.busquedaClientesAvanzada.literal.tipoColegio" | translate}} (*)</label>
          <p-dropdown [(ngModel)]="body.idTipoColegio" (ngModelChange)="actualizarDescripcionTipoColegio()" class="select-form" [options]="colegiosArray"
          [(disabled)]="isDisabledTipoColegio || disabledAction" placeholder="{{'general.boton.seleccionar' | translate}}"
          [filter]="true" filterBy="label,labelSinTilde" [showClear]="true"></p-dropdown>
        </div>
        <div *ngIf="esColegiado" class="form-group col-lg-3 col-md-6">
          <label>{{"censo.busquedaClientesAvanzada.literal.colegio" | translate}}</label>
          <p-dropdown [options]="colegios" [(ngModel)]="body.colegio" [(disabled)]="isDisabledColegio || disabledAction" class="select-form"
            (onChange)="onChangeColegio($event.value)" placeholder="{{'general.boton.seleccionar' | translate}}"
            [filter]="true" filterBy="label,labelSinTilde" [showClear]="true"></p-dropdown>
        </div>
        <div *ngIf="!esColegiado" class="form-group col-lg-3 col-md-6">
          <label>{{"censo.datosDireccion.literal.provincia" | translate}}</label>
          <p-dropdown [(ngModel)]="body.idProvincia" [(disabled)]="isDisabledProvincia || disabledAction" (ngModelChange)="actualizarDescripcionProvincia()"
            class="select-form" [options]="provinciasArray" placeholder="{{'general.boton.seleccionar' | translate}}"
            [filter]="true" filterBy="label,labelSinTilde" [showClear]="true"></p-dropdown>
        </div>
        <div class="form-group col-lg-3 col-md-6">
          <label>{{"censo.resultadoDuplicados.numeroColegiado" | translate}}</label>
          <input type="text" class="form-control" [(ngModel)]="body.numColegiado" [(disabled)]="isDisabledNumColegio || disabledAction"
            pInputText>
        </div>
      </div>
      <br>

      <!--END DATOS GENERALES-->
    </div>
  </div>

  <!-- COMIENZA VINCULACION -->
  <div class="card">
    <div class="card-header header-ficha">
      <div *ngIf="!esFichaActiva('vinculacion')" class="form-row">
        <div class="col-lg-1 col-md-2">
          <div class="img-colegiado" (click)="abrirFicha('vinculacion')">
            <i class="fa fa-users icon-ficha"> </i>
          </div>
        </div>
        <div class="col-lg-11 col-md-10">
          <div class="d-flex justify-content-start mb-1" (click)="abrirFicha('vinculacion')">
            <label  class="mr-auto title-ficha">{{"censo.busquedaClientes.literal.cargo" | translate}}</label>
          </div>
          <div class="d-flex justify-content-between">
            <label>{{"censo.consultaComponentesJuridicos.literal.fechaCargo" | translate}}
              <span>{{ body.fechaCargo }}</span>
            </label>
            <label>{{"censo.consultaComponentesJuridicos.literal.fechaFinCargo" | translate}}
              <span>{{ body.fechaBajaCargo }}</span>
            </label>
            <label>{{"censo.consultaComponentesJuridicos.literal.cargo" | translate}}
              <span>{{ descripcionCargo.label }}</span>
            </label>
            <label> {{"censo.consultaComponentesJuridicos.literal.descripcioncargo" | translate}}
              <span>{{ body.cargo }}</span>
            </label>
            <label>{{"censo.consultaComponentesJuridicos.literal.Participacion" | translate}}
              <span>{{ body.capitalSocial }}</span>
            </label>
            <i (click)="abrirFicha('vinculacion')" [ngClass]="{ 'fa fa-angle-up': openFicha, 'fa fa-angle-down': !openFicha} "></i>
          </div>
        </div>
      </div>
      <div *ngIf="esFichaActiva('vinculacion')" (click)="abrirFicha('vinculacion')" class=" header-ficha-open d-flex justify-content-start align-items-center">
        <div class="img-colegiado" (click)="abrirFicha('vinculacion')">
          <i class="fa fa-users icon-ficha"> </i>
        </div>
        <label (click)="abrirFicha('vinculacion')" class="title-ficha">{{"censo.busquedaClientes.literal.cargo" | translate}}</label>
        <i (click)="abrirFicha('vinculacion')" class="fa fa-angle-up ml-auto"></i>
      </div>
    </div>

    <!--cuerpo datos vinculacion-->

    <div *ngIf="esFichaActiva('vinculacion')" class="card-body card-body-ficha">
      <div class="d-flex align-items-end row">
        <div class="col-lg-3 col-md-6">
          <div class="form-row">
            <div class="form-group col-lg-6 col-md-6">
              <label>{{"censo.consultaComponentesJuridicos.literal.fechaCargo" | translate}}</label>
              <app-fecha [(value)]="fechaCarga" [disabled]="historico || disabledAction" [utc]="false" (valueChangeSelected)="fillFechaCarga($event)"
                (valueChangeInput)="detectFechaCargaInput($event)"></app-fecha>
            </div>
            <div class="form-group col-lg-6 col-md-6">
              <label>{{"censo.consultaDatos.literal.fechaFin" | translate}}</label>
              <app-fecha [(value)]="fechaBajaCargo" [disabled]="historico || disabledAction" [utc]="false" (valueChangeSelected)="fillFechaBajaCargo($event)"
                (valueChangeInput)="detectFechaBajaCargoInput($event)"></app-fecha>
            </div>
          </div>
        </div>
        <div class="form-check col-lg-1 col-md-2 mb-4">
          <p-checkbox [(ngModel)]='body.socio' binary="true" [(disabled)]="historico || disabledAction" label="Socio"></p-checkbox>
        </div>
        <div class="form-group col-lg-2 col-md-4">
          <label>{{"censo.consultaComponentesJuridicos.literal.cargo" | translate}}</label>
          <p-dropdown [(ngModel)]="body.idCargo" (ngModelChange)="actualizarDescripcionCargo()" [(disabled)]="historico || disabledAction"
            class="select-form" [options]="cargosArray" placeholder="{{'general.boton.seleccionar' | translate}}"
            [filter]="true" filterBy="label,labelSinTilde" [showClear]="true"></p-dropdown>
        </div>
        <div class="form-group col-lg-4 col-md-8">
          <label>{{"censo.consultaComponentesJuridicos.literal.descripcioncargo" | translate}}</label>
          <input type="text" class="form-control" [(disabled)]="historico || disabledAction" [(ngModel)]="body.cargo" pInputText>
        </div>
        <div class="form-group col-lg-2 col-md-4">
          <label>{{"censo.consultaComponentesJuridicos.literal.Participacion" | translate}}</label>
          <input type="text" class="form-control" [(disabled)]="historico || disabledAction" [(ngModel)]="body.capitalSocial" ui-number-mask="3"
            (ngModelChange)="onChange($event)" pInputText>
        </div>


      </div>
      <br>

      <!--END DATOS GENERALES-->
    </div>
    </div>

    <!--HISTORICO DE LIQUIDACION SJCS-->
    <div class="card">
      <div class="card-header header-ficha">
      <div *ngIf="!esFichaActiva('historicoLiquidacion')" class="form-row">
        <div class="col-lg-1 col-md-2">
          <div class="img-colegiado" (click)="abrirFicha('historicoLiquidacion')">
            <i class="fa fa-users icon-ficha"> </i>
          </div>
        </div>
        <div class="col-lg-11 col-md-10">
          <div class="d-flex justify-content-start mb-1" (click)="abrirFicha('historicoLiquidacion')">
            <label  class="mr-auto title-ficha">{{ "cen.integrantes.liquidacionSJCS" | translate }}</label>
          </div>
          <div class="d-flex justify-content-between">
            <label>{{"censo.consultaComponentesJuridicos.literal.fechaCargo" | translate}}
              <span>{{ body.fechaCargo }}</span>
            </label>
            <label>{{"censo.consultaComponentesJuridicos.literal.fechaFinCargo" | translate}}
              <span>{{ body.fechaBajaCargo }}</span>
            </label>
            <label>{{"censo.consultaComponentesJuridicos.literal.cargo" | translate}}
              <span>{{ descripcionCargo?.label }}</span>
            </label>
          </div>
        </div>
      </div>
      <div *ngIf="esFichaActiva('historicoLiquidacion')" (click)="abrirFicha('historicoLiquidacion')" class=" header-ficha-open d-flex justify-content-start align-items-center">
        <div class="img-colegiado" (click)="abrirFicha('vinculacion')">
          <i class="fa fa-users icon-ficha"> </i>
        </div>
        <label (click)="abrirFicha('historicoLiquidacion')" class="title-ficha">{{ "cen.integrantes.liquidacionSJCS" | translate }}</label>
        <i (click)="abrirFicha('historicoLiquidacion')" class="fa fa-angle-up ml-auto"></i>
      </div>
    </div>


    <div *ngIf="esFichaActiva('historicoLiquidacion')" class="card-body card-body-ficha">
      <p-table [columns]="cols" [(selection)]="selectedDatos" pageLinks="4" [ngClass]="{ customCursor: selectMultipleDirecciones }"
      [responsive]="true" selectionMode="multiple" #table class="tabla-listado" [value]="datosLiquidacion"
      [paginator]="true" paginatorPosition="both" [rows]="selectedItem" (onRowUnselect)="
      actualizaSeleccionados(selectedDatos)
      ">

      <ng-template pTemplate="body" let-datoH let-columns="columns" let-rowIndex="rowIndex">
        <tr [pSelectableRow]="datoH" [pSelectableRowIndex]="rowIndex">
          <td class="text-center" *ngFor="let col of columns">             
           <div *ngIf="col.field == 'fechaInicio'">
              <span *ngIf="!datoH.nuevo" class="text-center">{{ datoH[col.field] | date: 'dd/MM/yyyy'}}</span>
              <app-fecha *ngIf="datoH.nuevo" [minDate]="fechaMinima" [(value)]="nuevaFecha" (valueChangeSelected)="onChangeCalendar($event)" (valueChangeInput)="onChangeCalendar($event)" [appendTo] = "'body'"></app-fecha>
            </div>      
            <div *ngIf="col.field == 'sociedad'" class="text-center">
              <span>{{datoH[col.field]}}</span>
            </div>         
            <div *ngIf="col.field == 'observaciones'" class="d-block"  class="text-center">
              <span *ngIf="!datoH.nuevo">{{ datoH[col.field] }}</span>
              <textarea *ngIf="datoH.nuevo" class="form-control" pInputTextarea autoResize="autoResize" [(ngModel)]="observaciones" maxlength="1205" ngDefaultControl></textarea>
            </div>          
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="colgroup" let-columns>
        <colgroup>
          <col *ngFor="let col of columns" [style.width]="col.width">
        </colgroup>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th *ngFor="let col of columns" [ngSwitch]="col.field" [pSortableColumn]="col.field">
            {{col.header | translate}}
            <p-sortIcon [field]="col.field"></p-sortIcon>
            <input placeholder="{{ 'general.boton.search' | translate }}" pDroppable="false" (click)="$event.stopPropagation()" *ngSwitchCase="col.field" pInputText type="text" (input)="table.filter($event.target.value,
                            col.field, 'contains')">
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns>
        <tr>
          <td [attr.colspan]="columns.length">
            {{'censo.busquedaClientesAvanzada.literal.sinResultados' | translate }}
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="paginatorleft">
        <div class="mostrar d-flex text-right justify-content-end">
          <label class="pr-3 registros-totales">{{ 'informesycomunicaciones.plantillasenvio.ficha.mostrandoRegistros' | translate }} {{table.first
            + 1}} al {{table.first + table.rows}} {{ 'informesycomunicaciones.plantillasenvio.ficha.deUnTotalDe'
            | translate }} {{table.totalRecords}}
          </label>
          <label class="pr-3 numSeleccionados" *ngIf="selectedDatos  && selectedDatos.length > 0">{{'agenda.fichaCalendario.tablaNotificaciones.mostrandoRegistros' | translate}}: {{selectedDatos.length}}
          </label>
          <label class="pr-3 numSeleccionados" *ngIf="selectedDatos && selectedDatos.length <= 0">{{'agenda.fichaCalendario.tablaNotificaciones.mostrandoRegistros' | translate}}: 0
          </label>
          <label>{{"general.message.mostrar" | translate}}</label>
          <p-dropdown [(ngModel)]="selectedItem" [options]="rowsPerPage" (onChange)="onChangeRowsPerPages($event)">
          </p-dropdown>
          <label class="pl-1"> {{"cargaMasivaDatosCurriculares.numRegistros.literal" | translate}}</label>
          <div class="ml-3 selectAll">
            <p-checkbox (onChange)="onChangeSelectAll()" [(ngModel)]="selectAll" binary="true" label="{{ 'tablas.literal.seleccionarTodo' | translate }}"
              name="groupname"></p-checkbox>
          </div>
          <!-- <label class="ml-3 seleccionMultiple" [ngClass]="{' seleccion-multiple': selectMultiple}" (click)="isSelectMultiple()">
                <i class="pr-2 fa fa-mouse-pointer"></i>{{"general.message.seleccion.multiple" | translate}}</label> -->
        </div>
      </ng-template>
    </p-table>

  <br>

      <!--END HISTORICO DE LIQUIDACION SJCS-->
    </div>
    <div *ngIf="esFichaActiva('historicoLiquidacion')" class="mb-3 mr-3 text-right main-button ">
      <button *ngIf="!isGuardar"  (click)="crear()" pButton type="button" icon="fa fa-plus" iconPos="left" label="{{ 'general.boton.new' | translate}}"></button>
      <button *ngIf="isGuardar"  (click)="guardarLiquidacion()" pButton type="button" icon="fa fa-save" iconPos="left" label="{{ 'general.boton.guardar' | translate}}"></button>
      <button (click)="borrar()" pButton type="button" icon="fa fa-trash-alt" iconPos="left" label="{{'general.boton.eliminar'  | translate}}"></button>
    </div>
  </div>
  <div class="mt-3 text-right main-button ">
    <button (click)="backTo()" pButton type="button" icon="fa fa-angle-left" iconPos="left" label="{{ 'general.boton.volver' | translate}}"></button>
    <button *ngIf="editar" (click)="guardar();" pButton type="button" icon="	fa fa-edit " [(disabled)]="historico || disabledAction"
      iconPos="left" label="{{ 'general.boton.guardarCerrar' | translate}}"></button>
  </div>
</div>

<div *ngIf="progressSpinner" class="overlay-spinner">
  <!--<p-progressSpinner animationDuration="1s"></p-progressSpinner>-->
  <div class="loader"></div>
</div>