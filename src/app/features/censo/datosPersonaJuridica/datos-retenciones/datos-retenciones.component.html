<p-growl [(value)]="msgs" (onHover)="clear()" life="30000"></p-growl>

<div class="busqueda-container">
    <!--DATOS REGISTRALES-->
    <div class="card">
        <div class="card-header header-ficha" (click)="abrirFicha()">
            <div *ngIf="!openFicha" class="form-row">
                <div class="col-lg-1 col-md-2">
                    <div class="img-colegiado">
                        <i class="fa fa-dollar icon-ficha"></i>

                    </div>
                </div>
                <div class="col-lg-11 col-md-10">
                    <div class="d-flex justify-content-start mb-1">
                        <label class="mr-auto title-ficha">{{"menu.justiciaGratuita.maestros.retenciones" | translate}}</label>
                    </div>
                    <div class="d-flex justify-content-between">
                        <label>{{"facturacion.seriesFacturacion.literal.fInicio" | translate}}
                            <span>{{retencionNow.fechaInicio}}</span>
                        </label>

                        <label>{{"general.description" | translate}}
                            <span>{{retencionNow.descripcionRetencion}}</span>
                        </label>
                        <label>{{"FactSJCS.mantRetencionesJ.literal.tramoLec" | translate}}
                            <span>{{retencionNow.porcentajeRetencion}} %</span>
                        </label>
                        <i [ngClass]="{ 'fa fa-angle-up': openFicha, 'fa fa-angle-down': !openFicha} "></i>
                    </div>
                </div>
            </div>
            <div *ngIf="openFicha" class=" header-ficha-open d-flex justify-content-start align-items-center">
                <div class="img-colegiado">
                    <i class="fa fa-dollar icon-ficha"></i>
                </div>
                <label class="title-ficha">{{"menu.justiciaGratuita.maestros.retenciones" | translate}}</label>
                <i class="fa fa-angle-up ml-auto"></i>
            </div>
        </div>
        <!--cuerpo datos generales-->
        <div *ngIf="openFicha" class="card-body card-body-ficha">
            <div class="row">
                <p-dataTable emptyMessage="{{ 'general.message.no.registros' | translate}}" [(selection)]="selectedDatos" (onRowSelect)="irFichaColegial(selectedDatos)"
                    dataKey="idRetencion" selectionMode="multiple" [responsive]="true" #table class="tabla-listado" [value]="datos"
                    [sortOrder]="1" sortField="fechaFin" [paginator]="true" paginatorPosition="both" [rows]="selectedItem" pageLinks="4"
                    [editable]="true" [sortField]="sortF" [sortOrder]="sortO" (onSort)="changeSort($event)">

                    <p-column [sortable]="true" field="fechaInicio" filterPlaceholder="{{'general.boton.search' | translate}}" [header]="cols[0].header | translate"
                        [filter]="true" filterMatchMode="contains">
                        <ng-template let-col let-car="rowData" pTemplate="body">
                            <span>{{car[col.field]}} </span>
                            <p-calendar *ngIf="car[col.field] == ''" [(ngModel)]="nuevafecha" dateFormat="dd/mm/yy" [utc]="true" [locale]="es" [showIcon]="true"
                                (onSelect)="onChangeCalendar($event)" [minDate]="fechaMinima">
                            </p-calendar>


                        </ng-template>

                    </p-column>
                    <p-column [sortable]="true" field="fechaFin" [header]="cols[1].header | translate" [filter]="true" filterPlaceholder="{{'general.boton.search' | translate}}"
                        filterMatchMode="contains">
                        <ng-template let-col let-car="rowData" pTemplate="body">

                            <span>{{car[col.field]}}</span>

                        </ng-template>
                    </p-column>
                    <p-column [sortable]="true" field="descripcionRetencion" [header]="cols[2].header | translate" [filter]="true" filterPlaceholder="{{'general.boton.search' | translate}}"
                        filterMatchMode="contains">
                        <ng-template let-col let-car="rowData" pTemplate="body">
                            <span>{{car[col.field]}}</span>
                            <p-dropdown *ngIf="car[col.field] == '' " [(ngModel)]="newRetencion.descripcionRetencion" [options]="tiposRetenciones" (onChange)="onChangeDrop($event)"></p-dropdown>
                        </ng-template>
                    </p-column>
                    <p-column [sortable]="true" field="porcentajeRetencion" [header]="cols[3].header | translate" [filter]="true" filterPlaceholder="{{'general.boton.search' | translate}}"
                        filterMatchMode="contains">
                        <ng-template let-col let-car="rowData" pTemplate="body">
                            <span>{{car[col.field]}}</span>

                        </ng-template>
                    </p-column>

                    <ng-template pTemplate="paginatorLeft">
                        <div class="mostrar">
                            <label class="mt-2 pr-3 registros-totales">Mostrando registros del {{table.first + 1}} al {{table.first + table.rows}} de un total de {{table.totalRecords}}</label>
                            <label>{{ "general.message.mostrar" | translate}}</label>
                            <p-dropdown [(ngModel)]="selectedItem" [options]="rowsPerPage" (onChange)="onChangeRowsPerPages($event)"></p-dropdown>
                            <label class="pl-1"> {{"cargaMasivaDatosCurriculares.numRegistros.literal" | translate}}</label>
                        </div>
                    </ng-template>

                </p-dataTable>
            </div>

            <br>
            <!--FIN DE PRINCIPAL-->
        </div>

        <div *ngIf="openFicha" class="card-footer">
            <div class="text-right main-button">
                <button (click)="volver();" [(disabled)]="isVolver" pButton type="button" icon="fa fa-undo" iconPos="left" label="{{ 'general.boton.restablecer' | translate}}"></button>
                <button (click)="confirmEdit();" [(disabled)]="isEditar" pButton type="button" icon="	far fa-save " iconPos="left" label="{{ 'general.boton.guardar' | translate}}"></button>
                <button (click)="confirmarBorrar()" [(disabled)]="isEliminar" pButton type="button" icon="fa fa-trash-alt" iconPos="left"
                    label="{{'general.boton.eliminar'  | translate}}"></button>
                <button (click)="crear()" [(disabled)]="isCrear" pButton type="button" icon="fa fa-plus" iconPos="left" label="{{ 'general.boton.new' | translate}}"></button>
            </div>
        </div>

    </div>