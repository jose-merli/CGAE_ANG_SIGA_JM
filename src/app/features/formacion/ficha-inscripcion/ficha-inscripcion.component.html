<p-growl [(value)]="msgs" (onHover)="clear()" life="30000000"></p-growl>
<div class="busqueda-container">
  <div class="header-title">
    <i class="fa fa-square"></i>
    <p>{{ 'formacion.fichaInscripcion.cabecera' | translate }}</p>
  </div>


  <!-- TARJETAS CURSOS -->
  <div class="card">
    <!-- Cabecera -->
    <div class="card-header header-ficha">
      <div class="form-row">
        <div class="col-lg-1 col-md-2">
          <div class="img-colegiado">
            <i class="fa fa-bell icon-ficha"></i>
          </div>
        </div>
        <div class="col-lg-11 col-md-10">
          <div class="d-flex justify-content-start mt-2">
            <label class="mr-auto title-ficha">{{ 'formacion.fichaInscripcion.datosCursos.cabecera' | translate }}</label>
          </div>
          <div class="d-flex justify-content-between">
            <label>{{ 'form.busquedaCursos.literal.codigoCurso' | translate }}</label>
            <span>{{ curso.codigoCurso }}</span>
  
            <label>{{ 'formacion.busquedaInscripcion.nombreCurso' | translate }}</label>
            <span>{{ curso.nombreCurso }}</span>
  
            <label>{{ 'form.busquedaCursos.literal.fechaImparticionDesde' | translate }}</label>
            <span>{{ curso.fechaImparticionDesde }}</span>
  
            <label>{{ 'form.busquedaCursos.literal.fechaImparticionHasta' | translate }}</label>
            <span>{{ curso.fechaImparticionHasta }}</span>
  
            <label>{{ 'form.busquedaCursos.literal.temas' | translate }}</label>
            <span>{{ curso.temas }}</span>
  
            <label>{{ 'formacion.busquedaInscripcion.estadoCurso' | translate }}</label>
            <span>{{ curso.estado }}</span>
            <i class="fas fa-redo float-right" (click)="irFichaCurso()"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Cuerpo-->
    <!-- <div class="card-body card-body-ficha" *ngIf="esFichaActiva('curso')">
      
    </div> -->
  </div>

  <!-- FICHA DATOS INSCRIPCION -->
  <div class="card">
    <!-- Cabecera -->
    <div class="card-header header-ficha" (click)="abreCierraFicha('inscripcion')">
      <div *ngIf="!esFichaActiva('inscripcion')" class="form-row">
        <div class="col-lg-1 col-md-2">
          <div class="img-colegiado">
            <i class="fa fa-file-pdf icon-ficha"></i>
          </div>
        </div>
        <div class="col-lg-11 col-md-10">
          <div class="d-flex justify-content-start mt-2">
            <label class="mr-auto title-ficha">{{'formacion.fichaInscripcion.datosInscripcion.cabecera' | translate }}</label>
          </div>
        </div>
      </div>
      <div *ngIf="esFichaActiva('inscripcion')" class=" header-ficha-open d-flex justify-content-start align-items-center">
        <div class="img-colegiado">
          <i class="fa fa-file-pdf icon-ficha"></i>
        </div>
        <label class="title-ficha">{{'formacion.fichaInscripcion.datosInscripcion.cabecera' | translate }}</label>
        <i class="fa fa-angle-up ml-auto"></i>
      </div>
    </div>

    <!-- Cuerpo-->
    <div class="card-body card-body-ficha" *ngIf="esFichaActiva('inscripcion')">
      <div class="form-row lg-12 md-12">
        <div class="col-lg-4 col-md-4">
          <label>{{ 'censo.nuevaSolicitud.fechaSolicitud' | translate }}(*)</label>
          <p-calendar [locale]="es" [(ngModel)]="inscripcion.fechaSolicitud" dateFormat="dd/mm/yy" icon="far fa-calendar-alt" showIcon="true" [disabled]="modoEdicion" [minDate]="minDateFechaSolicitud"></p-calendar>
        </div>
        <div class="col-lg-4 col-md-4">
          <label>{{ "censo.busquedaSolicitudesModificacion.literal.estado" | translate}}</label>
          <p-dropdown placeholder="{{'general.boton.seleccionar' | translate}}" class="select-form" [(ngModel)]='inscripcion.idEstadoInscripcion'
            [options]="comboEstados" [filter]="true" filterBy="label,labelSinTilde" [disabled]="true"></p-dropdown>
        </div>
        <div class="col-lg-2 col-md-2">
          <label>{{ 'formacion.busquedaInscripcion.calificacion' | translate }}</label>
          <input type="text" class="form-control" pInputText name="calificacion" [(ngModel)]='inscripcion.calificacion' [disabled]="true">
        </div>
      </div>
      <div class="form-row lg-12 md-12" style="margin-top: 10px">
        <div class="col-lg-3 col-md-3">
          <label>{{ 'formacion.busquedaInscripcion.asistencia' | translate }}</label>
          <p-checkbox name="minimaAsistencia" binary="true" [(ngModel)]='inscripcion.checkMinimaAsistencia' [disabled]="true"></p-checkbox>
        </div>
      </div>
    </div>
    <div class="card-footer" *ngIf="esFichaActiva('inscripcion')">
      <div class="text-right main-button">
        <!-- <button pButton (click)="restEvent()" type="button" icon="fa fa-undo" iconPos="left" label="{{ 'general.boton.restablecer'| translate }}" [disabled]="tipoAccesoLectura"></button>
        <button pButton (click)="saveEvent()" type="button" icon="fa fa-search" iconPos="left" label="{{ 'general.boton.guardar' | translate }}" [disabled]="validateForm() || tipoAccesoLectura"></button>
       -->
       <button pButton type="button" icon="fa fa-undo" iconPos="left" label="{{ 'general.boton.restablecer'| translate }}" [disabled]="modoEdicion"></button>
       <button pButton type="button" icon="fa fa-search" iconPos="left" label="{{ 'general.boton.guardar' | translate }}" [disabled]="modoEdicion" (click)="guardarInscripcion()"></button>
      </div>
    </div>
  </div>

  <!-- TERJETAS PERSONAKES-->
  <div class="card">
    <div class="card-header header-ficha" (click)="abreCierraFichaPersonal('personales')">
      <div *ngIf="!esFichaActiva('personales')" class="form-row">
        <div class="col-lg-1 col-md-2">
          <div class="img-colegiado">
            <i class=" fa fa-user   icon-ficha"></i>
          </div>
        </div>
        <div class="col-lg-11 col-md-10">
          <div class="d-flex justify-content-start mb-1">
            <label class="mr-auto title-ficha">{{"formacion.fichaInscripcion.datosPersonales.cabecera" | translate}}</label>
          </div>
          <div class="d-flex justify-content-between">
            <label>{{"administracion.usuarios.literal.NIF" | translate}}
              <span>{{ persona.nif }}</span>
            </label>
            <label>{{"administracion.parametrosGenerales.literal.nombre" | translate}}
              <span>{{ persona.nombre }} {{ persona.apellido1 }} {{ persona.apellido2 }}</span>
            </label>
            <div></div>
  
            <div>
              <!-- <i class="fa fa-rotate-right redirect"></i> -->
              <i [ngClass]="{ 'fa fa-angle-up': esFichaActiva('personales'), 'fa fa-angle-down': esFichaActiva('personales')} "></i>
            </div>
  
          </div>
        </div>
      </div>
      <div *ngIf="esFichaActiva('personales')" class=" header-ficha-open d-flex justify-content-start align-items-center">
        <div class="img-colegiado">
          <i class=" fa fa-user   icon-ficha"></i>
        </div>
        <label class="title-ficha">{{"formacion.fichaInscripcion.datosPersonales.cabecera" | translate}}</label>
        <div class="ml-auto">
          <!-- <i class="fa fa-rotate-right redirect"></i> -->
          <i class="fa fa-angle-up " ></i>
        </div>
      </div>
    </div>
  
    <!--cuerpo datos generales-->
    <div *ngIf="esFichaActiva('personales')" class="card-body card-body-ficha">
      <div class="row">
        <div class="bloque col-lg-2 col-md-3 col-sm-3 p-2">
          <div class="img-colegiado text-center my-0 mx-auto">
            <i class="fa fa-user" style="font-size:6.5rem;color:grey"></i>
            <!-- <p-fileUpload #fubauto chooseLabel="" class="edit my-0 mx-auto main-button" mode="basic" name="file" auto="true" accept="image/*"
                            (change)="uploadImage($event)" auto="true">
                        </p-fileUpload> -->
          </div>
        </div>
        <div class="bloque col-lg-10 col-md-9">
  
          <div class="form-row">
            <div class="form-group col-lg-3 col-md-6">
              <label>{{"censo.fichaCliente.literal.identificacion" | translate}} (*)</label>
              <input type="text" class="form-control" [(ngModel)]="persona.nif" [disabled]="true" pInputText>
            </div>
            <div class="form-group col-lg-3 col-md-6">
              <label>{{"censo.busquedaClientesAvanzada.literal.tipoCliente" | translate}} (*)</label>
              <p-dropdown class="select-form" [(ngModel)]="selectedTipoIdentificacion" [options]="comboTipoIdentificacion" [disabled]="true"
                optionName="label"></p-dropdown>
            </div>
            <div class="form-group col-lg-3 col-md-6"></div>
            <div class="form-group col-lg-6 col-md-6">
              <label>{{"administracion.parametrosGenerales.literal.nombre" | translate}}</label>
              <input [(ngModel)]="persona.nombre" (ngModelChange)="activarGuardarNotarioNoExistente($event)" type="text" class="form-control"
                [(disabled)]="!editar" pInputText>
            </div>
            <div class="form-group col-lg-3 col-md-6">
              <label>{{"censo.busquedaClientes.literal.apellido1" | translate}}</label>
              <input [(ngModel)]="persona.apellido1" (ngModelChange)="activarGuardarNotarioNoExistente($event)" type="text" class="form-control"
                [(disabled)]="!editar" pInputText>
            </div>
            <div class="form-group col-lg-3 col-md-6">
              <label>{{"censo.busquedaClientes.literal.apellido2" | translate}}</label>
              <input [(ngModel)]="persona.apellido2" type="text " class="form-control" [(disabled)]="!editar" pInputText>
            </div>
  
          </div>
        </div>
      </div>
      <br>
  
    </div>
  
    <div *ngIf="esFichaActiva('personales')" class="card-footer ">
      <div class="text-right main-button ">
        <button (click)="actualizaPersona()" [(disabled)]="!guardarPersona" pButton type="button" icon="far fa-save" iconPos="left" label="{{ 'general.boton.guardar' | translate}}"></button>
        <button (click)="isSearch()" [(disabled)]="!isAdministrador" pButton type="button" icon="fa fa-search" iconPos="left" label="{{ 'general.boton.search' | translate}}"></button>
      </div>
    </div>
  </div>

  
<!-- 
 TERJETAS PAGO
  <div class="card">
  Cabecera
    <div class="card-header header-ficha" (click)="abreCierraFicha('pago')">
      <div *ngIf="!esFichaActiva('pago')" class="form-row">
        <div class="col-lg-1 col-md-2">
          <div class="img-colegiado">
            <i class="fa fa-list icon-ficha"></i>
          </div>
        </div>
        <div class="col-lg-11 col-md-10">
          <div class="d-flex justify-content-start mt-2">
            <label class="mr-auto title-ficha">{{ 'formacion.fichaInscripcion.datosPago.cabecera' | translate }}</label>
          </div>
        </div>
      </div>
      <div *ngIf="esFichaActiva('pago')" class=" header-ficha-open d-flex justify-content-start align-items-center">
        <div class="img-colegiado">
          <i class="fa fa-list icon-ficha"></i>
        </div>
        <label class="title-ficha">{{ 'formacion.fichaInscripcion.datosPago.cabecera' | translate }}</label>
        <i class="fa fa-angle-up ml-auto"></i>
      </div>
    </div>

    Cuerpo
    <div class="card-body card-body-ficha" *ngIf="esFichaActiva('pago')">
      <div *ngIf="esFichaActiva('pago')" class="card-body card-body-ficha">
        <div class="row">
          <div class="col-lg-6 col-md-6">
            <label>{{ 'form.busquedaCursos.literal.precio' | translate }}</label>
            <p-dropdown class="select-form" [options]="comboPrecio" name="precio" placeholder="{{'general.boton.seleccionar' | translate}}" name="precio"></p-dropdown>
          </div>
          <div class="col-lg-6 col-md-6">
            <label>{{ 'formacion.fichaInscripcion.datosPago.modoPago' | translate }}</label>
            <p-dropdown placeholder="{{'general.boton.seleccionar' | translate}}" class="select-form" [options]="comboModoPago"></p-dropdown>            
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-lg-6 col-md-6">
            <label>{{ 'formacion.fichaInscripcion.datosPago.pagada' | translate }}</label>
            <p-checkbox name="pagada" binary="true"></p-checkbox>
          </div>
          <div class="col-lg-6 col-md-6">
            <label>{{ 'formacion.fichaInscripcion.datosPago.comprobantePago' | translate }}</label>
            <input type="text" class="form-control" pInputText name="comprobantePago">
          </div>
        </div>
      </div>
    </div>
    <div class="card-footer" *ngIf="esFichaActiva('pago')">
      <div class="text-right main-button">
        <button pButton type="button" (click)="downloadTemplateFile()" icon="fa fa-download" iconPos="left" label="Descargar" [disabled]="tipoAccesoLectura"></button>
        <button pButton type="button" (click)="unCheckAsist()" [disabled]="!checkAsistencias" icon="fa fa-times" iconPos="left" label="Desmarcar" [disabled]="tipoAccesoLectura"></button>
        <button pButton type="button" (click)="checkAsist()" [disabled]="!checkAsistencias" icon="fa fa-check" iconPos="left" label="Marcar" [disabled]="tipoAccesoLectura"></button>
        <button pButton type="button" icon="fa fa-search" iconPos="left" label="{{ 'general.boton.guardar' | translate }}"></button>
      </div> 
      <div class="text-right main-button">
          <button pButton type="button" icon="fa fa-download" iconPos="left" label="{{ 'formacion.fichaInscripcion.datosPago.boton.pagar' | translate }}"></button>
          <button pButton type="button" icon="fa fa-times" iconPos="left" label="{{ 'formacion.fichaInscripcion.datosPago.boton.facturar' | translate }}"></button>
          <button pButton type="button" icon="fa fa-check" iconPos="left" label="{{ 'formacion.fichaInscripcion.datosPago.boton.pagar' | translate }}"></button>
          <button pButton type="button" icon="fa fa-search" iconPos="left" label="{{ 'general.boton.guardar' | translate }}"></button>
        </div>
    </div>
  </div> -->


<!-- TERJETAS CERTIFICADO-->
<div class="card">
  <!-- Cabecera -->
  <div class="card-header header-ficha" (click)="abreCierraFichaPersonal('certificado')">
    <div *ngIf="!esFichaActiva('certificado')" class="form-row">
      <div class="col-lg-1 col-md-2">
        <div class="img-colegiado">
          <i class="fa fa-certificate icon-ficha"></i>
        </div>
      </div>
      <div class="col-lg-11 col-md-10">
        <div class="d-flex justify-content-start mt-2">
          <label class="mr-auto title-ficha">{{'formacion.fichaInscripcion.datosCertificados.cabecera' | translate}}</label>
        </div>
      </div>
    </div>
    <div *ngIf="esFichaActiva('certificado')" class=" header-ficha-open d-flex justify-content-start align-items-center">
      <div class="img-colegiado">
        <i class="fa fa-certificate icon-ficha"></i>
      </div>
      <label class="title-ficha">{{'formacion.fichaInscripcion.datosCertificados.cabecera' | translate}}</label>
      <i class="fa fa-angle-up ml-auto"></i>
    </div>
  </div>

  <!-- Cuerpo -->
  <div class="card-body card-body-ficha" *ngIf="esFichaActiva('certificado')">
    <div *ngIf="esFichaActiva('certificado')" class="card-body card-body-ficha">
      <div class="row">
        <div class="bloque col-lg-7 col-md-7">
          <!-- <p-dataTable emptyMessage="{{ 'general.message.no.registros' | translate}}" 
            dataKey="idCertificadoCurso" selectionMode="multiple" [(selection)]="selectedDatosCertificates" [responsive]="true"
            #tableCertificates class="tabla-listado" [paginator]="true" 
            [value]="datosCertificates" [sortOrder]="1" [paginator]="true" paginatorPosition="both" [rows]="selectedCertificates"> -->

            <p-dataTable emptyMessage="{{ 'general.message.no.registros' | translate}}" 
           [ngClass]="{'customCursor': selectMultiple}" [(selection)]="selectedDatos"
            pageLinks="4" dataKey="idCertificadoCurso" [responsive]="true" selectionMode="multiple" #tableCertificates class="tabla-listado" [value]="datosCertificates"
            [sortOrder]="sortO" [paginator]="true" paginatorPosition="both" [rows]="selectedCertificates">

            <p-column *ngFor="let col of colsCertificates" [sortable]="true " [field]="col.field" [header]="col.header | translate" filterPlaceholder="{{'general.boton.search' | translate}}"
            [filter]="true" filterMatchMode="contains">
            </p-column>
<!-- 
            <p-column [sortable]="true" [field]="colsCertificates[0].field" [header]="
                      'menu.certificados'
                        | translate
                    " [filter]="true" filterPlaceholder="{{'general.boton.search' | translate}}" filterMatchMode="contains">
              <ng-template let-col let-dato="rowData" pTemplate="body">
                <span>{{ dato[colsCertificates[0].value] }}
                </span>
              </ng-template>
            </p-column>

            <p-column [sortable]="true" [field]="colsCertificates[1].field" [header]="
                      'form.busquedaCursos.literal.precio'
                        | translate
                    " [filter]="true" filterPlaceholder="{{'general.boton.search' | translate}}" filterMatchMode="contains">
              <ng-template let-col let-dato="rowData" pTemplate="body">
                <span>{{ dato[colsCertificates[1].field] }}
                </span>
              </ng-template>
            </p-column>

            <p-column [sortable]="true" [field]="colsCertificates[2].field" [header]="'formacion.busquedaInscripcion.calificacion' | translate"
              [filter]="true" filterPlaceholder="{{'general.boton.search' | translate}}" filterMatchMode="contains">
              <ng-template let-dato="rowData" pTemplate="body">
                <span>{{ dato[colsCertificates[2].value] }}
                </span>
              </ng-template>
            </p-column> -->

            <ng-template pTemplate="paginatorLeft">
              <div class="mostrar d-flex text-right justify-content-end">
                <label class="pr-3 registros-totales">Mostrando registros del {{ tableCertificates.first + 1 }} al {{ tableCertificates.first + tableCertificates.rows
                  }} de un total de {{ tableCertificates.totalRecords }}</label>
                <label class="pr-3 numSeleccionados">Seleccionados: {{ numSelectedCertificates }}</label>
                <label>{{ "general.message.mostrar" | translate }}</label>
                <p-dropdown [(ngModel)]="selectedCertificates" [options]="rowsPerPage" (onChange)="onChangeRowsPerPages($event)"></p-dropdown>
                <label class="pl-1">
                  {{ "cargaMasivaDatosCurriculares.numRegistros.literal" | translate }}
                </label>
              </div>
            </ng-template>
          </p-dataTable>
        </div>

        <div class="bloque col-lg-5 col-md-5">
          <label>Emitir certificado</label>
          <p-checkbox name="checkCertificado" binary="true" [(ngModel)]="inscripcion.isCertificadoAutomatico" [disabled]="checkCertificadoAutomatico"></p-checkbox>
        </div>
      </div>
    </div>
  </div>

    
  <div class="card-footer" *ngIf="esFichaActiva('certificado')">

    <div class="text-right main-button ">
      <button pButton type="button" iconPos="left" label="Generar" [disabled]="!generarCertificado" (click)="generarSolicitudCertificado()"></button>
      <button pButton type="button" icon="far fa-save" iconPos="left" label="{{ 'general.boton.guardar' | translate }}" [disabled]="checkCertificadoAutomatico" (click)="actualizarCertificado()"></button>
    </div>
  </div>

</div>


  <div class="text-right main-button">
  <button (click)="backTo()" pButton type="button" icon="fa fa-angle-left" iconPos="left" label="{{ 'general.boton.volver' | translate}}"></button>
  </div>

  <app-dialog></app-dialog>
  <div *ngIf="progressSpinner " class="overlay-spinner ">
    <div class="loader "></div>
  </div>