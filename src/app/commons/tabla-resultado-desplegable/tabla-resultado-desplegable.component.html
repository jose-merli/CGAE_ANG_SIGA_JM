<p-growl [(value)]="msgs" (onHover)="clear()" life="30000"></p-growl>

<div class="padding-interior padding-superior">
    <app-paginador3 (perPage)="perPage($event)" (seleccionarTodo)="selectedAll($event)" (fromReg)="fromReg($event)" (toReg)="toReg($event)" [totalRegistros]="totalRegistros"></app-paginador3>
</div>

<div class="center mb-3">
    <p-multiSelect #mySelect [formControl]="info" [(ngModel)]='selectedHeader' [options]="cabeceras" optionLabel="name"
        optionValue="id" (onChange)="ocultarColumna($event)" defaultLabel="0 visibles" maxSelectedLabels="0"
        [selectedItemsLabel]="textSelected">
    </p-multiSelect> Columnas
</div>
<div style="padding-left: 2.25rem;padding-right: 1.25rem;">
    <div class="table w-100" matSort (matSortChange)="sortData($event)" #table id="tablaResultadoDesplegable">
        <div class="table-header ">
            <div class="table-header-child p-2" *ngFor="let cabecera of cabeceras; let j = index" #BorderedHeader
                [id]="cabecera.id">
                <div class="ajustarCabecera">
                    <div [mat-sort-header]=cabecera.id [pTooltip]="cabecera.nameComplete" tooltipPosition="top">
                        {{cabecera.name}}</div>
                    <input type="text" class="form-control ajustarBuscador" pInputTex [(ngModel)]="searchText[j]"
                        (ngModelChange)="searchChange(j)" autocomplete="off" placeholder="Buscar">
                </div>
            </div>
        </div>
        <div *ngFor="let rowGroup of rowGroups | slice:from:to" class="table-row-group" #rowGroupEl>
            <div class="table-row parent" >
                
                <span *ngIf="rowGroup.rows.length > 1" class="mr-2 arrow" (click)="rowGroupArrowClick(rowGroupEl, rowGroup.id)">
                    <span (click)="iconClickChange(iconrightEl, icondownEl)" #iconrightEl><i
                            class="fas fa-chevron-right"></i></span>
                    <span class="collapse" (click)="iconClickChange2(iconrightEl, icondownEl)" #icondownEl><i
                            class="fas fa-chevron-down"></i></span>
                </span>
                <div (click)="selectRow(rowSelected, rowGroup.id, i)" class="table-row-wrapper hoverBlue"
                    [ngClass]="{'hoverBlue2': isSelected(rowGroup.id), 'fixedBlue': seleccionarTodo}" 
                    #rowSelected>

                    <div *ngIf="!posicionOcultar(-1) && pantalla != 'JE'" class="table-row-header p-2 selectedRowClass selectWrap" [id]="rowGroup.id">
                        <span class="w100 cell-value selectWrap enlace"(click)="linkFichaAsistencia(rowGroup.id)"><a>{{rowGroup.id}}</a></span>
                    </div>
                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'" class="table-row-header p-2 selectedRowClass" [id]="rowGroup.id">
                        <span [ngClass]="{'color-red': colorByStateDesigmacion(rowGroup.estadoDesignacion) == 'red', 'color-blue': colorByStateDesigmacion(rowGroup.estadoDesignacion) == 'blue', 'color-green': colorByStateDesigmacion(rowGroup.estadoDesignacion) == 'green', 'color-black': colorByStateDesigmacion(rowGroup.estadoDesignacion) == 'black'}">D{{rowGroup.id}} </span>
                    </div>

                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'" class="table-row-header p-2 selectedRowClass" [id]="rowGroup.id2">
                        <span [ngClass]="{'color-red': colorByStateExpediente(rowGroup.estadoEx) == 'red', 'color-blue': colorByStateExpediente(rowGroup.estadoEx) == 'blue', 'color-black': colorByStateExpediente(rowGroup.estadoEx) == 'black'}">  <span *ngIf="rowGroup.id2 != ''" >E</span>{{rowGroup.id2}}</span>
                    </div>

                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'" class="table-row-header p-2 selectedRowClass" [id]="rowGroup.id3">
                        {{rowGroup.id3}}   
                    </div>

                    <div *ngFor="let cell of rowGroup.rows[0]['cells'] | slice:0:9; let z = index"
                        class="table-cell p-2 selectedRowClass" #BorderedCell
                        [ngClass]="{'collapse':posicionOcultar(z)}" #cellSelected>

                       <div *ngIf="cell.type != 'invisible'" [ngStyle]="setMyStyles(cell.size)" class="cell-wrapper selectedRowClass w-100">
                            <span class="column-title">{{cabeceras[z+1].name}}</span>
                            <span class="w100 cell-value selectWrap" *ngIf="cell.type == 'text'">{{cell.value}}</span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'buttom'"><button  (click)="toDoButton(cell.value, rowGroup.id, rowGroup, rowGroupEl)"class="buttomStyle" 
                                    pButton type="button" iconPos="left" [label]="cell.value"></button></span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'checkboxPermisos'">
                                <p-checkbox (onChange)="checkBoxChange($event, rowGroup.id, cell, row, rowGroup)" [disabled]="colegiado" [(ngModel)]="cell.value" binary="true" >
                                </p-checkbox> 
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'checkbox'">
                                <p-checkbox (onChange)="checkBoxChange($event, rowGroup.id, cell, row, rowGroup)" [(ngModel)]="cell.value" binary="true" >
                                </p-checkbox> 
                            </span>

                            <span class="w100 cell-value" *ngIf="cell.type == 'checkboxDate'">
                                <p-checkbox (onChange)="checkBoxDateChange($event, rowGroup.id, cell, row, rowGroup)" [(ngModel)]="cell.value" binary="true" >
                                </p-checkbox> 
                            </span>
                            
                            <span class="w100 cell-value" *ngIf="cell.type == 'datePicker'">
                                <app-fecha [(value)]="cell.value" [utc]="false" (valueChangeSelected)="fillFecha($event, cell, rowGroup.id, row, rowGroup)"
                                (valueChangeInput)="fillFecha($event, cell, rowGroup.id, row, rowGroup)" [showTime]="cell.showTime">
                              </app-fecha>
                            </span>
                           <!----<span class="w100 cell-value selectWrap" *ngIf="cell.type == 'select'">
                                    <app-selector class="wrapText center" [i]="0" [selector]="cell.value"
                                    [textoVisible]="cell.value.nombre"></app-selector>
                                </span>-->
                            
                            <span class="w100 cell-value selectWrap wrapText" *ngIf="cell.type == 'select'">
                                <p-dropdown autoWidth="false" class="center" placeholder="{{'general.boton.seleccionar' | translate}}" [(ngModel)]="cell.value"
                                [options]="cell.combo" showClear="true" styleClass="widthAll" (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"
                                [disabled]="cell.disabled">
                                </p-dropdown>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'number'">{{cell.value}}</span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'link'"><a>{{cell.value}}</a></span>
                            <span class="w100 cell-value" *ngIf="cell.type == '5InputSelector'"
                                [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                <input type="text" class="form-control " pInputText size="10" [(ngModel)]="cell.value[0]" 
                                    [value]="cell.value[0]" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup);"
                                    (change) = "onChangeNifJg($event.target.value, rowGroup.id, row, rowGroup);" placeholder ="{{'administracion.usuarios.literal.NIF' | translate}}">
                                <input type="text" class="form-control " pInputText size="10" [(ngModel)]="cell.value[1]" 
                                    [value]="cell.value[1]" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)" placeholder="{{'gratuita.mantenimientoTablasMaestra.literal.apellidos' | translate}}">
                                <input type="text" class="form-control " pInputText size="10" [(ngModel)]="cell.value[2]" 
                                    [value]="cell.value[2]" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)" placeholder="{{'gratuita.mantenimientoTablasMaestra.literal.apellidos' | translate}}">
                                <input type="text" class="form-control " pInputText size="10" [(ngModel)]="cell.value[3]" 
                                    [value]="cell.value[3]" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)" placeholder="{{'administracion.parametrosGenerales.literal.nombre' | translate}}">
                                <p-dropdown autoWidth="false" class="center" [(ngModel)]="cell.value[4]" placeholder = "{{'censo.busquedaClientesAvanzada.literal.sexo' | translate}}"
                                [options]="cell.combo" showClear="true" styleClass="widthAll" (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == '2SelectorInput'"
                                [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                <p-dropdown autoWidth="false" class="center width60" [(ngModel)]="cell.value[0]" placeholder = "{{'justiciaGratuita.ejg.preDesigna.delitos' | translate}}"
                                    [options]="cell.combo" filterBy="label,labelSinTilde" [filter]="true" showClear="true" styleClass="widthAll" (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>
                                <input type="text" class="form-control" pInputText size="10" [value]="cell.value[1]" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)" placeholder="{{'gratuita.mantenimientoLG.literal.observaciones' | translate}}">
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'input'">
                               <input type="text"
                                    class="form-control" pInputText size="10" [(ngModel)]="cell.value" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"></span>
                            <span class="w100 cell-value d-flex" *ngIf="cell.type == 'buttomSelect'">
                                <div class="main-button" style="width: 40%;">
                                    <button pButton type="button" iconPos="left" [label]="cell.value[0]"
                                        (click)="cell.value[3] == 'C' ? cell.value[3] = 'J' :  cell.value[3] = 'C'"></button>
                                </div>

                                <!-- <app-selector [i]="cell.value[4]" [selector]="cell.value[3] == 'C' ? cell.value[1] : cell.value[2]"
                                    style="width: 60%;" (value)="onChangeSelector($event, row, cell, rowGroup.id, row, rowGroup)">
                                </app-selector>-->
                                <p-dropdown autoWidth="false" class="center width60" [(ngModel)]="cell.value[4]" placeholder = "{{'general.boton.seleccionar' | translate}}" [filter]="true" 
                                    [options]="cell.value[3] == 'C' ? cell.value[1] : cell.value[2]" showClear="true" filterBy="label,labelSinTilde" styleClass="widthAll" (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'textTooltip'">
                                <span [pTooltip]="cell.value[0]" tooltipPosition="right">{{ cell.value[1] }}</span>
                            </span>
                            <span class="w100 cell-value selectWrap wrapText" *ngIf="cell.type == 'multiselect1' || cell.type == 'multiselect2' || cell.type == 'multiselect3'">
                                <!--<p-multiSelect #{i} autoWidth="false" [(ngModel)]='cell.value' [selectedItemsLabel]="textSelected" [defaultLabel]="textFilter"
                                [options]="cell.combo" maxSelectedLabels="10"  styleClass="widthAll"
                                [filter]="true" filterBy="label,labelSinTilde" (onChange)="onChangeMulti($event, row['id'], cell, z)" >
                                </p-multiSelect>-->
                                <p-dropdown autoWidth="false" class="inputWidth" placeholder="{{'general.boton.seleccionar' | translate}}" [ngModelOptions]="cell.combo"
                                [(ngModel)]='cell.value' filterBy="label,labelSinTilde" [filter] = "true" [options]="cell.combo" showClear="true" (onChange)="onChangeMulti($event, row['id'], cell, z)" class="select-form">
                                </p-dropdown>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div *ngFor="let row of rowGroup.rows | slice:1; let i = index" class="table-row child"  [ngClass]="{'collapse': row.position == 'collapse'}">
                <div (click)="selectRow(rowSelected, rowGroup.id + i, i)" class="table-row-wrapper hoverBlue"
                    [ngClass]="{'hoverBlue2': isSelected(rowGroup.id + i), 'fixedBlue': seleccionarTodo}"
                    [id]="rowGroup.id" #rowSelected>
                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'" class="table-row-header p-2 hidden selectedRowClass">
                    </div>
                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'" class="table-row-header p-2 hidden selectedRowClass">
                    </div>
                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'" class="table-row-header p-2 hidden selectedRowClass">
                    </div>
                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'AE'" class="table-row-header p-2 hidden selectedRowClass">
                    </div>
                    <div *ngFor="let cell of row['cells']  | slice:0:9; let z = index" class="table-cell p-2 selectedRowClass"
                        [ngClass]="{'collapse':posicionOcultar(z), 'borders-child': isPar(i)}" #cellSelected>
                        <div *ngIf="cell.type != 'invisible'" [ngStyle]="setMyStyles(cell.size)" class="cell-wrapper selectedRowClass w-100">
                            <span class="column-title">{{cabeceras[z+1].name}}</span>
                            <span class="w100 cell-value selectWrap" *ngIf="cell.type == 'text'" (click)="linkFichaActIfPermis(row, rowGroup)">{{cell.value}}</span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'buttom'"><button (click)="toDoButton(cell.value, rowGroup.id, rowGroup, rowGroupEl)" class="buttomStyle" pButton type="button"
                                    iconPos="left" [label]="cell.value"></button></span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'checkboxPermisos'">
                                <p-checkbox (onChange)="checkBoxChange($event, rowGroup.id, cell, row, rowGroup)" [disabled]="colegiado" [(ngModel)]="cell.value" binary="true" >
                                </p-checkbox> 
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'checkbox'">
                                <p-checkbox (onChange)="checkBoxChange($event, rowGroup.id, cell, row, rowGroup)" [(ngModel)]="cell.value" binary="true" >
                                </p-checkbox> 
                            </span>
                            
                            <span class="w100 cell-value" *ngIf="cell.type == 'checkboxDate'">
                                <p-checkbox (onChange)="checkBoxDateChange($event, rowGroup.id, cell, row, rowGroup)" [(ngModel)]="cell.value" binary="true" >
                                </p-checkbox> 
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'datePicker'">
                                <app-fecha [(value)]="cell.value" [utc]="false" (valueChangeSelected)="fillFecha($event, cell, rowGroup.id, row, rowGroup)"
                                (valueChangeInput)="fillFecha($event, cell, rowGroup.id, row, rowGroup)" [showTime]="cell.showTime">
                              </app-fecha>
                            </span>
                            <!--<span class="w100 cell-value selectWrap" *ngIf="cell.type == 'select'">
                                <app-selector class="center" [i]="0" [textoVisible]="" [selector]="cell.value">
                                </app-selector>
                            </span>-->
                                                        
                            <span class="w100 cell-value selectWrap wrapText" *ngIf="cell.type == 'select'">
                                <p-dropdown autoWidth="false" class="center" [(ngModel)]="cell.value"
                                [options]="cell.combo" showClear="true" styleClass="widthAll" (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"
                                [disabled]="cell.disabled">
                                </p-dropdown>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'number'">{{cell.value}}</span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'link'"><a>{{cell.value}}</a></span>
                            <span class="w100 cell-value" *ngIf="cell.type == '5InputSelector'"
                                [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                <input type="text" class="form-control " pInputText size="10"
                                    [value]="cell.value[0]" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup);"[(ngModel)]="cell.value[0]"
                                    (change) = "onChangeNifJg($event.target.value, rowGroup.id, row, rowGroup);" >
                                <input type="text" class="form-control " pInputText size="10"
                                    [value]="cell.value[1]" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)" [(ngModel)]="cell.value[1]" >
                                <input type="text" class="form-control " pInputText size="10"
                                    [value]="cell.value[2]" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)" [(ngModel)]="cell.value[2]" >
                                <input type="text" class="form-control " pInputText size="10"
                                    [value]="cell.value[3]" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)" [(ngModel)]="cell.value[3]" >
                                <p-dropdown autoWidth="false" class="center" [(ngModel)]="cell.value[4]" placeholder = "{{'censo.busquedaClientesAvanzada.literal.sexo' | translate}}"
                                    [options]="cell.combo" showClear="true" styleClass="widthAll" (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == '2SelectorInput'"
                                [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                <p-dropdown autoWidth="false" class="center" [(ngModel)]="cell.value[0]" placeholder = "{{'justiciaGratuita.ejg.preDesigna.delitos' | translate}}" [filter]="true"
                                    [options]="cell.combo" showClear="true" filterBy="label,labelSinTilde" styleClass="widthAll" (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>
                                <input type="text" class="form-control" pInputText [value]="cell.value[1]">
                            </span>
                            <span class="w100 cell-value d-flex" *ngIf="cell.type == 'buttomSelect'">
                                <div class="main-button" style="width: 40%;">
                                    <button pButton type="button" iconPos="left" [label]="cell.value[0]"
                                        (click)="cell.value[3] == 'C' ? cell.value[3] = 'J' :  cell.value[3] = 'C'"></button>
                                </div>

                             <!-- <app-selector [i]="cell.value[4]" [selector]="cell.value[3] == 'C' ? cell.value[1] : cell.value[2]"
                                    style="width: 60%;" (value)="onChangeSelector($event, row, cell, rowGroup.id, row, rowGroup)">
                                </app-selector>-->
                                <p-dropdown autoWidth="false" [(ngModel)]="cell.value[4]" placeholder = "{{'general.boton.seleccionar' | translate}}" [filter]="true" class="center width60"
                                    [options]="cell.value[3] == 'C' ? cell.value[1] : cell.value[2]" showClear="true" filterBy="label,labelSinTilde" styleClass="widthAll" (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'textTooltip'">
                                <span [pTooltip]="cell.value[0]" tooltipPosition="right">{{ cell.value[1] }}</span>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'input'">
                                <input type="text"
                                     class="form-control" pInputText size="10" [(ngModel)]="cell.value" (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"></span>
                                     <span class="w100 cell-value selectWrap wrapText" *ngIf="cell.type == 'multiselect1' || cell.type == 'multiselect2' || cell.type == 'multiselect3'">
                                        <!--<p-multiSelect #{i} autoWidth="false" [(ngModel)]='cell.value' [selectedItemsLabel]="textSelected" [defaultLabel]="textFilter"
                                        [options]="cell.combo" maxSelectedLabels="10"  styleClass="widthAll"
                                        [filter]="true" filterBy="label,labelSinTilde" (onChange)="onChangeMulti($event, row['id'], cell, z)" >
                                        </p-multiSelect>-->
                                        <p-dropdown autoWidth="false" class="inputWidth" [ngModelOptions]="cell.combo"
                                [(ngModel)]='cell.value' filterBy="label,labelSinTilde" [filter] = "true" [options]="cell.combo" showClear="true" (onChange)="onChangeMulti($event, row['id'], cell, z)" class="select-form">
                                </p-dropdown>
                                    </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div *ngIf="pantalla == 'JE'" class="right col-lg-12 col-md-6 ajustar marginButtons">
    <div class="inline-block text-right main-button">
        <button [disabled]="disableDelete" pButton type="button" icon="fa fa-trash-alt" iconPos="left" label="Eliminar" (click)="eliminar()">
        </button>

        <button pButton type="button" icon="fa fa-comment" iconPos="left" label="Comunicar">
        </button>
        
        <button pButton type="button" icon="far fa-save" iconPos="left" label="Guardar"  (click)="guardar()">
        </button>
    </div>
</div>
<div *ngIf="progressSpinner" class="overlay-spinner">
    <div class="loader"></div>
</div>