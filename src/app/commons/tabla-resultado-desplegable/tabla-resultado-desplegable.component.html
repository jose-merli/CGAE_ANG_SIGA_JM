<p-growl [(value)]="msgs" (onHover)="clear()" life="30000"></p-growl>

<div>
    <app-paginador3 (perPage)="perPage($event)" (seleccionarTodo)="selectedAll($event)" (fromReg)="fromReg($event)"
        (toReg)="toReg($event)" [totalRegistros]="totalRegistros"></app-paginador3>
</div>

<div class="center sameLine setDiv selectColumnas">
    <p-multiSelect #mySelect [formControl]="info" [(ngModel)]='selectedHeader' [options]="cabeceras" optionLabel="name"
        optionValue="id" (onChange)="ocultarColumna($event)" defaultLabel="0 visibles" maxSelectedLabels="0"
        [selectedItemsLabel]="textSelected">
    </p-multiSelect> Columnas
</div>

<div style="padding-left: 0.5rem">
    <label *ngIf="!todoDesplegado" (click)="expandAll()" class="desplegar-todo">Desplegar todo
        <i class="fa fa-angle-down"></i>
    </label>
    <label *ngIf="todoDesplegado" (click)="collapseAll()" class="desplegar-todo">Plegar todo
        <i class="fa fa-angle-up"></i>
    </label>
    <div class="table w-100" matSort (matSortChange)="sortData($event)" #table id="tablaResultadoDesplegable">
        <div class="table-header ">
            <div class="table-header-child p-2" *ngFor="let cabecera of cabeceras; let j = index"
                [ngStyle]="setMyStyles(cabecera.size)" #BorderedHeader [id]="cabecera.id">
                <div class="ajustarCabecera" [ngStyle]="setMyStyles(cabecera.size)">
                    <div [mat-sort-header]=cabecera.id [pTooltip]="cabecera.nameComplete" tooltipPosition="top"
                        disableClear>
                        {{cabecera.name}}</div>
                    <input type="text" class="form-control ajustarBuscador" pInputTex [(ngModel)]="searchText[j]"
                        (ngModelChange)="searchChange(j)" autocomplete="off" placeholder="Buscar">
                </div>
            </div>
        </div>
        <div *ngFor="let rowGroup of rowGroups | slice:from:to" class="table-row-group" #rowGroupEl>
            <div class="table-row parent">

                <span *ngIf="rowGroup.rows.length > 1 && pantalla != 'JE'" class="mr-2 arrow"
                    (click)="rowGroupArrowClick(rowGroupEl, rowGroup.id); selectRow(rowSelected, rowGroup.id, i)">
                    <span (click)="iconClickChange(iconrightEl, icondownEl)" #iconrightEl><i
                            class="fas fa-chevron-right"></i></span>
                    <span class="collapse" (click)="iconClickChange2(iconrightEl, icondownEl)" #icondownEl><i
                            class="fas fa-chevron-down"></i></span>
                </span>
                <div (click)="selectRow(rowSelected, rowGroup.id, i)" class="table-row-wrapper hoverBlue"
                    [ngClass]="{'hoverBlue2': isSelected(rowGroup.id), 'fixedBlue': seleccionarTodo}" #rowSelected>

                    <div *ngIf="!posicionOcultar(-1) && pantalla != 'JE'"
                        class="table-row-header p-2 selectedRowClass mw70"
                        [ngClass]="{'hoverToClick': rowGroup.rows.length > 1}" [id]="rowGroup.id">
                        <span class="w-100 cell-value enlace"><a
                                (click)="linkFichaDesigna(rowGroup, rowGroup.id)">{{rowGroup.id}}</a></span>
                    </div>
                    <!--<div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'" class="table-row-header p-2 selectedRowClass" [id]="rowGroup.id">
                        <span [ngClass]="{'color-red': colorByStateDesigmacion(rowGroup.estadoDesignacion) == 'red', 'color-blue': colorByStateDesigmacion(rowGroup.estadoDesignacion) == 'blue', 'color-green': colorByStateDesigmacion(rowGroup.estadoDesignacion) == 'green', 'color-black': colorByStateDesigmacion(rowGroup.estadoDesignacion) == 'black'}">D{{rowGroup.id}} </span>
                    </div>-->
                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'"
                        class="table-row-header p-2 selectedRowClass mw80" [id]="rowGroup.id">
                        <span *ngIf="rowGroup.rows.length > 1" class="arrow2"
                            [ngClass]="{'hoverToClick': rowGroup.rows.length > 1}">
                            <span class="arrow2"
                                (click)="rowGroupArrowClick(rowGroupEl, rowGroup.id); iconClickChange(iconrightEl, icondownEl)"
                                #iconrightEl><i class="fas fa-chevron-right"></i></span>
                            <span class="collapse arrow2"
                                (click)="rowGroupArrowClick(rowGroupEl, rowGroup.id); iconClickChange2(iconrightEl, icondownEl)"
                                #icondownEl><i class="fas fa-chevron-down"></i></span>
                        </span>

                        <span *ngIf="permisosFichaAct == true" class="enlace"
                            (click)="linkFichaDesigna(rowGroup, rowGroup.id)">D{{rowGroup.id}} </span>
                        <span *ngIf="permisosFichaAct == false">D{{rowGroup.id}} </span>
                    </div>

                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'"
                        class="table-row-header p-2 selectedRowClass mw80" [id]="rowGroup.id2">
                        <span *ngIf="permisosEJG == true" class="enlace"
                            (click)="linkToFichaEJG(rowGroup, rowGroup.id2);" [pTooltip]="rowGroup.estadoEx"
                            tooltipPosition="top"
                            [ngClass]="{'color-red': colorByStateExpediente(rowGroup.resolucionDesignacion) == 'red', 'color-blue': colorByStateExpediente(rowGroup.resolucionDesignacion) == 'blue', 'color-black': colorByStateExpediente(rowGroup.resolucionDesignacion) == 'black'}">
                            <span *ngIf="rowGroup.id2 != ''">E</span>{{rowGroup.id2}}</span>
                        <span *ngIf="permisosEJG == false" [pTooltip]="rowGroup.estadoEx" tooltipPosition="top"
                            [ngClass]="{'color-red': colorByStateExpediente(rowGroup.resolucionDesignacion) == 'red', 'color-blue': colorByStateExpediente(rowGroup.resolucionDesignacion) == 'blue', 'color-black': colorByStateExpediente(rowGroup.resolucionDesignacion) == 'black'}">
                            <span *ngIf="rowGroup.id2 != ''">E</span>{{rowGroup.id2}}</span>
                        <button *ngIf="rowGroup.resolucionDesignacion != 'SIN_RESOLUCION' && rowGroup.id2 != ''" pButton
                            type="button" icon="fa fa-comment" iconPos="left"
                            (click)="navigateComunicarJE(rowGroup, rowGroup.id2)"></button>

                    </div>

                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'"
                        class="table-row-header p-2 selectedRowClass wrapName mw100" [id]="rowGroup.id3">
                        <span class="wrapName2">{{rowGroup.id3}}</span>
                    </div>

                    <div *ngFor="let cell of rowGroup.rows[0]['cells'] | slice:fromRowGroup:toRowGroup; let z = index"
                        class="table-cell p-2 selectedRowClass" #BorderedCell
                        [ngClass]="{'collapse':posicionOcultar(z + numCell)}" [ngStyle]="setMyStyles(cell.size)"
                        #cellSelected>

                        <div *ngIf="cell.type != 'invisible'" [ngStyle]="setMyStyles(cell.size)"
                            class="cell-wrapper selectedRowClass w-100">
                            <span class="column-title">{{cabeceras[z+1].name}}</span>
                            <span class="w100 cell-value selectWrap" *ngIf="cell.type == 'text'">{{cell.value}}</span>
                            <span class="w100 cell-value selectWrap" *ngIf="cell.type == 'tooltip'"
                                [pTooltip]="cell.combo" tooltipPosition="bottom">{{cell.value}} </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'buttom'"><button
                                    (click)="toDoButton(cell.value, rowGroup.id, rowGroup, rowGroupEl)"
                                    class="buttomStyle" pButton type="button" iconPos="left"
                                    [label]="cell.value"></button></span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'checkboxPermisos'">
                                <p-checkbox *ngIf="cell.value[0] != undefined"
                                    (onChange)="checkBoxChange($event, rowGroup.id, cell, row, rowGroup, true, z)"
                                    [disabled]="isLetrado || cell.combo" [(ngModel)]="cell.value[0]" binary="true">
                                </p-checkbox>
                                <span style="float: right;"
                                    *ngIf="cell.value[2] != undefined && cell.value[2] == '1'"><i
                                        class="fas fa-paperclip"></i></span>
                                <div *ngIf="cell.value[1] == 'Nuevo'"><button
                                        (click)="toDoButton(cell.value[1], rowGroup.id, rowGroup, rowGroupEl)"
                                        class="buttomStyle" [disabled]="isLetrado" pButton type="button" iconPos="left"
                                        [label]="cell.value[1]"></button></div>
                                <div *ngIf="cell.value[1] != 'Nuevo' && permisosFichaAct"><a
                                        (click)="linkFichaActIfPermis(row, rowGroup)"
                                        class="enlace">{{cell.value[1]}}</a></div>
                                <div *ngIf="cell.value[1] != 'Nuevo' && !permisosFichaAct">{{cell.value[1]}}</div>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'checkbox'">
                                <p-checkbox
                                    (onChange)="checkBoxChange2($event, rowGroup.id, cell, row, rowGroup, true, z)"
                                    [(ngModel)]="cell.value" binary="true" [disabled]="isLetrado || cell.combo">
                                </p-checkbox>
                            </span>

                            <span class="w100 cell-value" *ngIf="cell.type == 'checkboxDate'">
                                <p-checkbox
                                    (onChange)="checkBoxDateChange($event, rowGroup.id, cell, row, rowGroup, true, z)"
                                    [(ngModel)]="cell.value" binary="true" [disabled]="isLetrado">
                                </p-checkbox>
                            </span>

                            <span class="w100 cell-value" *ngIf="cell.type == 'datePicker'">
                                <app-fecha [(value)]="cell.value" [utc]="false"
                                    (valueChangeSelected)="fillFecha($event, cell, rowGroup.id, row, rowGroup, true, z)"
                                    (valueChangeInput)="fillFecha($event, cell, rowGroup.id, row, rowGroup, undefined, z)"
                                    [disabled]="isLetrado" [showTime]="cell.showTime">
                                </app-fecha>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'datePickerAsist'">
                                <app-fecha [(value)]="cell.value" [utc]="false"
                                    (valueChangeSelected)="fillFechaAsist($event, cell, rowGroup.id, row, rowGroup, true, z)"
                                    (valueChangeInput)="fillFechaAsist($event, cell, rowGroup.id, row, rowGroup, undefined, z)"
                                    [disabled]="isLetrado" [showTime]="cell.showTime">
                                </app-fecha>
                            </span>
                            <!----<span class="w100 cell-value selectWrap" *ngIf="cell.type == 'select'">
                                    <app-selector class="wrapText center" [i]="0" [selector]="cell.value"
                                    [textoVisible]="cell.value.nombre"></app-selector>
                                </span>-->

                            <span class="w100 cell-value selectWrap wrapText" *ngIf="cell.type == 'select'">
                                <p-dropdown [autoWidth]="true" class="center" [placeholder]="'Seleccionar'"
                                    [(ngModel)]="cell.value" [options]="cell.combo" showClear="true"
                                    [filter]="true" filterBy="label,labelSinTilde"
                                    styleClass="widthAll colorAmarillo"
                                    (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup, true, z)"
                                    [disabled]="cell.disabled">
                                </p-dropdown>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'number'">{{cell.value}}</span>
                            <span class="w100 cell-value enlace" *ngIf="cell.type == 'link' && pantalla == 'JE'"><a
                                    class="enlace">{{cell.value}}</a></span>
                            <span class="w100 cell-value enlace" *ngIf="cell.type == 'link' && pantalla == 'AE'"><a
                                    class="enlace"
                                    (click)="linkToFichaEJG(rowGroup, cell.value);">{{cell.value}}</a></span>
                            <span class="w100 cell-value" *ngIf="cell.type == '5InputSelector'"
                                [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                <input type="text" class="form-control " pInputText size="10"
                                    [(ngModel)]="cell.value[0]" [value]="cell.value[0]" [ngClass]="cell.value[0]"
                                    (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup);"
                                    (change)="onChangeNifJg($event.target.value, rowGroup.id, row, rowGroup);"
                                    placeholder="{{'administracion.usuarios.literal.NIF' | translate}}">
                                <input type="text" class="form-control " pInputText size="10"
                                    [(ngModel)]="cell.value[1]" [value]="cell.value[1]"
                                    [ngClass]="styleObligatorio(cell.value[1])"
                                    (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                    placeholder="{{'gratuita.mantenimientoTablasMaestra.literal.apellidos' | translate}}">
                                <input type="text" class="form-control " pInputText size="10"
                                    [(ngModel)]="cell.value[2]" [value]="cell.value[2]"
                                    (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                    placeholder="{{'gratuita.mantenimientoTablasMaestra.literal.apellidos' | translate}}">
                                <input type="text" class="form-control " pInputText size="10"
                                    [(ngModel)]="cell.value[3]" [value]="cell.value[3]"
                                    [ngClass]="styleObligatorio(cell.value[3])"
                                    (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                    placeholder="{{'administracion.parametrosGenerales.literal.nombre' | translate}}">
                                <p-dropdown autoWidth="false" class="center" [(ngModel)]="cell.value[4]"
                                    [ngClass]="styleObligatorio(cell.value[4])"
                                    placeholder="{{'censo.busquedaClientesAvanzada.literal.sexo' | translate}}"
                                    [options]="cell.combo" showClear="true" styleClass="widthAll"
                                    (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == '6InputSelector' && pantalla != 'JE'"
                                [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                <div class="d-flex flex-column flex-wrap w-100">
                                    <div class="d-flex flex-row align-items-center">
                                        <input type="text" class="form-control " pInputText size="10" style="width: 33.33%;"
                                            [(ngModel)]="cell.value[0]" [value]="cell.value[0]" [ngClass]="cell.value[0]"
                                            (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup);"
                                            (change)="onChangeNifJg($event.target.value, rowGroup.id, row, rowGroup);"
                                            placeholder="{{'administracion.usuarios.literal.NIF' | translate}}">
                                        <p-dropdown autoWidth="false" class="un-tercio" [(ngModel)]="cell.value[4]"
                                            [ngClass]="styleObligatorio(cell.value[4])"
                                            placeholder="{{'censo.busquedaClientesAvanzada.literal.sexo' | translate}}"
                                            [options]="cell.combo" showClear="true" styleClass="widthAll"
                                            (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)">
                                        </p-dropdown>
                                        <app-fecha [(value)]="cell.value[5]" [utc]="false"
                                            [showTime]="cell.showTime" [(ngModel)]="cell.value[5]" style="width: 33.33%;"
                                            placeholder="{{'justiciaGratuita.guardia.asistenciasexpress.fnacimiento' | translate}}"
                                            (valueChangeSelected)="fillFechaValue($event, cell, rowGroup.id, 5)"
                                            (valueChangeInput)="fillFechaValue($event, cell, rowGroup.id, 5)">
                                        </app-fecha>
                                    </div>
                                    <div class="d-flex flex-row">    
                                        <input type="text" class="form-control " pInputText size="10"
                                            [(ngModel)]="cell.value[1]" [value]="cell.value[1]"
                                            [ngClass]="styleObligatorio(cell.value[1])"
                                            (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                            placeholder="{{'gratuita.mantenimientoTablasMaestra.literal.apellidos' | translate}}">
                                        <input type="text" class="form-control " pInputText size="10"
                                            [(ngModel)]="cell.value[2]" [value]="cell.value[2]"
                                            (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                            placeholder="{{'gratuita.mantenimientoTablasMaestra.literal.apellidos' | translate}}">                               
                                        <input type="text" class="form-control " pInputText size="10"
                                            [(ngModel)]="cell.value[3]" [value]="cell.value[3]"
                                            [ngClass]="styleObligatorio(cell.value[3])"
                                            (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                            placeholder="{{'administracion.parametrosGenerales.literal.nombre' | translate}}">
                                    </div>
                                </div>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'dateAndTime' && pantalla != 'JE'"
                                [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                <div class="d-flex flex-column flex-wrap w-100 align-items-center">
                                    <app-fecha [(value)]="cell.value[0]" [utc]="false"
                                        [showTime]="false" [(ngModel)]="cell.value[0]" class="w-100"
                                        (valueChangeSelected)="fillFechaValue($event, cell, rowGroup.id, 0)"
                                        (valueChangeInput)="fillFechaValue($event, cell, rowGroup.id, 0)">
                                    </app-fecha>
                                    <input type="time" class="form-control hora-minuto-input"
                                        [(ngModel)]="cell.value[1]" [value]="cell.value[1]" [ngClass]="cell.value[1]"
                                        (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup);">
                                </div>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == '2SelectorInput'"
                                [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                <!--<p-dropdown autoWidth="false" class="center width60" [(ngModel)]="cell.value[0]" placeholder = "{{'justiciaGratuita.ejg.preDesigna.delitos' | translate}}"
                                    [options]="cell.combo" filterBy="label,labelSinTilde" [filter]="true" showClear="true" styleClass="widthAll" (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>-->
                                <div  class="w-100">
                                    <p-multiSelect class="select-form center w-100" [(ngModel)]='cell.value[0]'
                                        [options]="cell.combo" [filter]="true" maxSelectedLabels="10"
                                        filterBy="label,labelSinTilde" selectionLimit="10" styleClass="widthAll"
                                        defaultLabel="{{ 'justiciaGratuita.ejg.preDesigna.delitos' | translate}}"
                                        (onChange)="onChangeMulti($event, rowGroup.id, cell, z, true, z)"></p-multiSelect>

                                    <input type="text" class="form-control" pInputText size="10" [value]="cell.value[1]"
                                        [(ngModel)]="cell.value[1]"
                                        (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                        placeholder="{{'gratuita.mantenimientoLG.literal.observaciones' | translate}}">
                                </div>
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'input'">
                                <input type="text" class="form-control" pInputText size="10" [placeholder]="cell.value"
                                    [(ngModel)]="cell.value"
                                    (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup, true, z)">
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == '2input' && pantalla != 'JE'">
                                <input type="text" class="form-control" pInputText size="10" 
                                    placeholder="{{'gratuita.mantAsistencias.literal.numeroDiligenciasolo' | translate}}"
                                    [(ngModel)]="cell.value[0]" [value]="cell.value[0]">

                                <input type="text" class="form-control" pInputText size="10" [placeholder]="cell.value[1]"
                                    placeholder="{{'justiciaGratuita.justiciables.literal.numprocedimiento' | translate}}"
                                    [(ngModel)]="cell.value[1]" [value]="cell.value[1]">
                            </span>
                            <span class="w100 cell-value d-flex" *ngIf="cell.type == 'buttomSelect'">
                                <div class="main-button" style="width: 30%;">
                                    <button pButton type="button" iconPos="left" [label]="cell.value[0]"
                                        (click)="onClickBotonJuzProc(cell, rowGroup)"></button>
                                </div>

                                <!-- <app-selector [i]="cell.value[4]" [selector]="cell.value[3] == 'C' ? cell.value[1] : cell.value[2]"
                                    style="width: 60%;" (value)="onChangeSelector($event, row, cell, rowGroup.id, row, rowGroup)">
                                </app-selector>-->
                                <p-dropdown autoWidth="false" class="center width70 showFull"
                                    [(ngModel)]="cell.value[4]" [ngClass]="styleObligatorio(cell.value[4])"
                                    placeholder="{{'general.boton.seleccionar' | translate}}" [filter]="true"
                                    [options]="cell.value[3] == 'C' ? cell.value[1] : cell.value[2]" showClear="true"
                                    filterBy="label,labelSinTilde" styleClass="widthAll"
                                    (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>
                                
                            </span>
                            <span class="w100 cell-value d-flex" *ngIf="cell.type == 'ComJuzSelect' && pantalla != 'JE'">
                    
                                <div class="w-100">
                                    <p-dropdown autoWidth="false" class="center showFull"
                                    [(ngModel)]="cell.value[2]" [ngClass]="styleObligatorio(cell.value[3] != '' ? cell.value[3] : cell.value[2])"
                                    placeholder="{{'general.boton.seleccionar' | translate}}" [filter]="true"
                                    [options]="cell.value[0]" showClear="true"
                                    filterBy="label,labelSinTilde" styleClass="widthAll"
                                    (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup); onChangeSelectJuzCom(cell, row, 'C')"></p-dropdown>

                                    <p-dropdown autoWidth="false" class="center showFull"
                                    [(ngModel)]="cell.value[3]" [ngClass]="styleObligatorio(cell.value[2] != '' ? cell.value[2] : cell.value[3])"
                                    placeholder="{{'general.boton.seleccionar' | translate}}" [filter]="true"
                                    [options]="cell.value[1]" showClear="true"
                                    filterBy="label,labelSinTilde" styleClass="widthAll"
                                    (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup); onChangeSelectJuzCom(cell, row, 'J')"></p-dropdown>
                                </div>
                                
                                
                            </span>
                            <span class="w100 cell-value" *ngIf="cell.type == 'textTooltip'">
                                <span [pTooltip]="cell.value[0]" tooltipPosition="right">{{ cell.value[1] }}</span>
                            </span>
                            <span class="w100 cell-value selectWrap wrapText"
                                *ngIf="cell.type == 'multiselect1' || cell.type == 'multiselect2' || cell.type == 'multiselect3'">
                                <!--<p-multiSelect #{i} autoWidth="false" [(ngModel)]='cell.value' [selectedItemsLabel]="textSelected" [defaultLabel]="textFilter"
                                [options]="cell.combo" maxSelectedLabels="10"  styleClass="widthAll"
                                [filter]="true" filterBy="label,labelSinTilde" (onChange)="onChangeMulti($event, row['id'], cell, z)" >
                                </p-multiSelect>-->
                                <p-dropdown autoWidth="false" class="inputWidth" [placeholder]="'Seleccionar'"
                                    [ngModelOptions]="cell.combo" [(ngModel)]='cell.value'
                                    filterBy="label,labelSinTilde" [filter]="true" [options]="cell.combo"
                                    showClear="true" (onChange)="onChangeMulti($event, row['id'], cell, z, true, z)"
                                    class="select-form">
                                </p-dropdown>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngFor="let row of rowGroup.rows | slice:1; let i = index" class="table-row child"
                [ngClass]="{'collapse': row.position == 'collapse'}">
                <div *ngIf="row.position != 'collapse'" (click)="selectRow(rowSelected, rowGroup.id + i, i)"
                    class="table-row-wrapper hoverBlue"
                    [ngClass]="{'hoverBlue2': isSelected(rowGroup.id + i), 'fixedBlue': seleccionarTodo}"
                    [id]="rowGroup.id" #rowSelected>

                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'"
                        class="table-row-header p-2 hidden selectedRowClass">
                    </div>
                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'"
                        class="table-row-header p-2 hidden selectedRowClass">
                    </div>
                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'JE'"
                        class="table-row-header p-2 hidden selectedRowClass">
                    </div>
                    <div *ngIf="!posicionOcultar(-1) && pantalla == 'AE'"
                        class="table-row-header p-2 hidden selectedRowClass mw70">
                    </div>
                    <div *ngFor="let cell of row['cells']  | slice:fromRowGroup:toRowGroup; let z = index"
                        class="table-cell p-2 selectedRowClass"
                        [ngClass]="{'collapse':posicionOcultar(z + numCell), 'borders-child': isPar(i)}"
                        [ngStyle]="setMyStyles(cell.size)" #cellSelected>
                        <div *ngIf="cell.type != 'invisible'" [ngStyle]="setMyStyles(cell.size)"
                            class="cell-wrapper selectedRowClass w-100">
                                <span class="column-title">{{cabeceras[z+1].name}}</span>
                                <span class="w100 cell-value selectWrap"
                                    *ngIf="cell.type == 'text'" [ngClass]="{'actuacionAnulada': row.cells[14].type=='actuacionAnulada'}">{{cell.value}}</span>
                                <span class="w100 cell-value selectWrap" *ngIf="cell.type == 'tooltip'"
                                    [pTooltip]="cell.combo" tooltipPosition="bottom" [ngClass]="{'actuacionAnulada': row.cells[14].type=='actuacionAnulada'}">{{cell.value}}</span>
                                <span class="w100 cell-value" *ngIf="cell.type == 'buttom'"><button
                                        (click)="toDoButton(cell.value, rowGroup.id, rowGroup, rowGroupEl)"
                                        class="buttomStyle" pButton type="button" iconPos="left"
                                        [label]="cell.value"></button></span>
                                <span class="w100 cell-value" *ngIf="cell.type == 'checkboxPermisos'">
                                    <p-checkbox *ngIf="cell.value[0] != undefined"
                                        (onChange)="checkBoxChange($event, rowGroup.id, cell, row, rowGroup, false, i)"
                                        [disabled]="isLetrado" [(ngModel)]="cell.value[0]" binary="true">
                                    </p-checkbox>
                                    <div *ngIf="cell.value[1] == 'Nuevo'"><button
                                            (click)="toDoButton(cell.value[1], rowGroup.id, rowGroup, rowGroupEl)"
                                            class="buttomStyle" pButton type="button" iconPos="left"
                                            [label]="cell.value[1]"
                                            [disabled]="isLetrado || comprobarCombos(rowGroup)"></button></div>
                                    <div *ngIf="cell.value[1] != 'Nuevo' && permisosFichaAct"><a
                                            (click)="linkFichaActIfPermis(row, rowGroup)"
                                            class="enlace">{{cell.value[1]}}</a>
                                        <span style="float: right;"
                                            *ngIf="cell.value[2] != undefined && cell.value[2] == '1'"><i
                                                class="fas fa-paperclip"></i></span>
                                    </div>
                                    <div *ngIf="cell.value[1] != 'Nuevo' && !permisosFichaAct">{{cell.value[1]}}
                                        <span style="float: right;"
                                            *ngIf="cell.value[2] != undefined && cell.value[2] == '1'"><i
                                                class="fas fa-paperclip"></i></span>
                                    </div>
                                </span>
                                <span class="w100 cell-value" *ngIf="cell.type == 'checkbox'">
                                    <p-checkbox
                                        (onChange)="checkBoxChange2($event, rowGroup.id, cell, row, rowGroup, false, i)"
                                        [(ngModel)]="cell.value" binary="true" [disabled]="isLetrado || cell.combo || row.cells[14].type=='actuacionAnulada'">
                                    </p-checkbox>
                                </span>

                                <span class="w100 cell-value" *ngIf="cell.type == 'checkboxDate'">
                                    <p-checkbox
                                        (onChange)="checkBoxDateChange($event, rowGroup.id, cell, row, rowGroup, false, i)"
                                        [(ngModel)]="cell.value" binary="true" [disabled]="isLetrado">
                                    </p-checkbox>
                                </span>
                                <span class="w100 cell-value" *ngIf="cell.type == 'datePicker'">
                                    <app-fecha [(value)]="cell.value" [utc]="false"
                                        (valueChangeSelected)="fillFecha($event, cell, rowGroup.id, row, rowGroup, false, i)"
                                        (valueChangeInput)="fillFecha($event, cell, rowGroup.id, row, rowGroup, undefined, i)"
                                        [disabled]="isLetrado" [showTime]="cell.showTime">
                                    </app-fecha>
                                </span>
                                <span class="w100 cell-value" *ngIf="cell.type == 'datePickerAct'">
                                    <app-fecha [(value)]="cell.value" [utc]="false"
                                        (valueChangeSelected)="fillFecha($event, cell, rowGroup.id, row, rowGroup, false, i)"
                                        (valueChangeInput)="fillFecha($event, cell, rowGroup.id, row, rowGroup, undefined, i)"
                                        [disabled]="isLetrado" [showTime]="cell.showTime">
                                    </app-fecha>
                                </span>
                                <!--<span class="w100 cell-value selectWrap" *ngIf="cell.type == 'select'">
                                <app-selector class="center" [i]="0" [textoVisible]="" [selector]="cell.value">
                                </app-selector>
                                </span>-->

                                <span class="w100 cell-value selectWrap wrapText" *ngIf="cell.type == 'select' && !estaValidada(row)">
                                    <p-dropdown autoWidth="false" class="center" [(ngModel)]="cell.value"
                                        [options]="cell.combo" showClear="true" styleClass="widthAll"
                                        (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup, false, i)"
                                        [disabled]="cell.disabled">
                                    </p-dropdown>
                                </span>

                                <span class="w100 cell-value selectWrap wrapText" *ngIf="cell.type == 'select' && estaValidada(row)">
                                    <span [pTooltip]="searchLabelValorCombo(cell)" tooltipPosition="right">{{ cell.value }}</span>
                                </span>

                                <span class="w100 cell-value selectWrap wrapText" *ngIf="cell.type == 'tooltip' && estaValidada(row)">
                                    <span [pTooltip]="cell.combo" tooltipPosition="right">{{ cell.value }}</span>
                                </span>

                                <span class="w100 cell-value" *ngIf="cell.type == 'number'">{{cell.value}}</span>
                                <span class="w100 cell-value enlace" *ngIf="cell.type == 'link'"><a
                                        (click)="linkFichaActIfPermis(row, rowGroup)">{{cell.value}}</a></span>
                                <span class="w100 cell-value" *ngIf="cell.type == '5InputSelector'"
                                    [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                    <input type="text" class="form-control " pInputText size="10"
                                        [value]="cell.value[0]"
                                        (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup);"
                                        [(ngModel)]="cell.value[0]" [ngClass]="styleObligatorio(cell.value[0])"
                                        (change)="onChangeNifJg($event.target.value, rowGroup.id, row, rowGroup);">
                                    <input type="text" class="form-control " pInputText size="10"
                                        [value]="cell.value[1]"
                                        (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                        [(ngModel)]="cell.value[1]" [ngClass]="styleObligatorio(cell.value[1])">
                                    <input type="text" class="form-control " pInputText size="10"
                                        [value]="cell.value[2]"
                                        (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                        [(ngModel)]="cell.value[2]">
                                    <input type="text" class="form-control " pInputText size="10"
                                        [value]="cell.value[3]"
                                        (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                        [(ngModel)]="cell.value[3]" [ngClass]="styleObligatorio(cell.value[3])">
                                    <p-dropdown autoWidth="false" class="center" [(ngModel)]="cell.value[4]"
                                        [ngClass]="styleObligatorio(cell.value[4])"
                                        placeholder="{{'censo.busquedaClientesAvanzada.literal.sexo' | translate}}"
                                        [options]="cell.combo" showClear="true" styleClass="widthAll"
                                        (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup)"></p-dropdown>
                                </span>
                                <span class="w100 cell-value" *ngIf="cell.type == '2SelectorInput'"
                                    [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                    <p-multiSelect class="select-form center " [(ngModel)]='cell.value[0]'
                                        [options]="cell.combo" [filter]="true" maxSelectedLabels="10"
                                        filterBy="label,labelSinTilde" selectionLimit="10" styleClass="widthAll"
                                        defaultLabel="{{ 'justiciaGratuita.ejg.preDesigna.delitos' | translate}}"
                                        (onChange)="onChangeMulti($event, rowGroup.id, cell, z, true, z)"></p-multiSelect>

                                    <input type="text" class="form-control" pInputText size="10" [value]="cell.value[1]"
                                        [(ngModel)]="cell.value[1]"
                                        (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup)"
                                        placeholder="{{'gratuita.mantenimientoLG.literal.observaciones' | translate}}">
                                </span>
                                <span class="w100 cell-value d-flex" *ngIf="cell.type == 'buttomSelect'">
                                    <div class="main-button" style="width: 30%;">
                                        <button pButton type="button" iconPos="left" [label]="cell.value[0]"
                                            (click)="onClickBotonJuzProc(cell, rowGroup)"></button>
                                    </div>

                                    <!-- <app-selector [i]="cell.value[4]" [selector]="cell.value[3] == 'C' ? cell.value[1] : cell.value[2]"
                                    style="width: 60%;" (value)="onChangeSelector($event, row, cell, rowGroup.id, row, rowGroup)">
                                </app-selector>-->
                                    <p-dropdown autoWidth="false" [(ngModel)]="cell.value[4]" [ngClass]="styleObligatorio(cell.value[4])"
                                        placeholder="{{'general.boton.seleccionar' | translate}}" [filter]="true"
                                        class="center width70 showFull"
                                        [options]="cell.value[3] == 'C' ? cell.value[1] : cell.value[2]"
                                        showClear="true" filterBy="label,labelSinTilde" styleClass="widthAll"
                                        (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup, false, i)"></p-dropdown>
                                </span>
                                
                            <span class="w100 cell-value d-flex" *ngIf="cell.type == 'ComJuzSelect' && pantalla != 'JE'">
                    
                                <div class="w-100">
                                    <p-dropdown autoWidth="false" class="center showFull"
                                    [(ngModel)]="cell.value[2]" [ngClass]="styleObligatorio(cell.value[3] != '' ? cell.value[3] : cell.value[2])"
                                    placeholder="{{'general.boton.seleccionar' | translate}}" [filter]="true"
                                    [options]="cell.value[0]" showClear="true"
                                    filterBy="label,labelSinTilde" styleClass="widthAll"
                                    (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup); onChangeSelectJuzCom(cell, row, 'C')"></p-dropdown>

                                    <p-dropdown autoWidth="false" class="center showFull"
                                    [(ngModel)]="cell.value[3]" [ngClass]="styleObligatorio(cell.value[2] != '' ? cell.value[2] : cell.value[3])"
                                    placeholder="{{'general.boton.seleccionar' | translate}}" [filter]="true"
                                    [options]="cell.value[1]" showClear="true"
                                    filterBy="label,labelSinTilde" styleClass="widthAll"
                                    (onChange)="changeSelect(row, cell, rowGroup.id, row, rowGroup); onChangeSelectJuzCom(cell, row, 'J')"></p-dropdown>
                                </div>
                                
                                
                            </span>
                                <span class="w100 cell-value" *ngIf="cell.type == 'textTooltip'">
                                    <span [pTooltip]="cell.value[0]" tooltipPosition="right">{{ cell.value[1] }}</span>
                                </span>
                                <span class="w100 cell-value" *ngIf="cell.type == 'input'">
                                    <input type="text" class="form-control" pInputText size="10"
                                        [placeholder]="cell.value" [(ngModel)]="cell.value"
                                        (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup, false, i)">
                                </span>
                                
                                <span class="w100 cell-value" *ngIf="cell.type == 'dateAndTime' && pantalla != 'JE'"
                                    [ngClass]="{'column-d-flex': changeDisplay() == true}">
                                    <div class="d-flex flex-column flex-wrap w-100 align-items-center">
                                        <app-fecha [(value)]="cell.value[0]" [utc]="false"
                                            [showTime]="false" [(ngModel)]="cell.value[0]" class="w-100"
                                            (valueChangeSelected)="fillFechaValue($event, cell, rowGroup.id, 0)"
                                            (valueChangeInput)="fillFechaValue($event, cell, rowGroup.id, 0)">
                                        </app-fecha>
                                        <input type="time" class="form-control hora-minuto-input"
                                            [(ngModel)]="cell.value[1]" [value]="cell.value[1]" [ngClass]="cell.value[1]"
                                            (input)="inputChange($event.target.value, rowGroup.id, row, rowGroup);">
                                    </div>
                                </span>
                                <span class="w100 cell-value" *ngIf="cell.type == '2input' && pantalla != 'JE'">
                                    <input type="text" class="form-control" pInputText size="10" 
                                        placeholder="{{'gratuita.mantAsistencias.literal.numeroDiligenciasolo' | translate}}"
                                        [(ngModel)]="cell.value[0]" [value]="cell.value[0]">
    
                                    <input type="text" class="form-control" pInputText size="10" [placeholder]="cell.value[1]"
                                        placeholder="{{'justiciaGratuita.justiciables.literal.numprocedimiento' | translate}}"
                                        [(ngModel)]="cell.value[1]" [value]="cell.value[1]">
                                </span>
                                <span class="w100 cell-value selectWrap wrapText"
                                    *ngIf="cell.type == 'multiselect1' || cell.type == 'multiselect2' || cell.type == 'multiselect3'">
                                    <!--<p-multiSelect #{i} autoWidth="false" [(ngModel)]='cell.value' [selectedItemsLabel]="textSelected" [defaultLabel]="textFilter"
                                        [options]="cell.combo" maxSelectedLabels="10"  styleClass="widthAll"
                                        [filter]="true" filterBy="label,labelSinTilde" (onChange)="onChangeMulti($event, row['id'], cell, z)" >
                                        </p-multiSelect>-->
                                    <p-dropdown autoWidth="false" class="inputWidth" [ngModelOptions]="cell.combo"
                                        [autoWidth]="false" [(ngModel)]='cell.value' filterBy="label,labelSinTilde"
                                        [filter]="true" [options]="cell.combo" showClear="true"
                                        (onChange)="onChangeMulti($event, row['id'], cell, z, false, i)"
                                        class="select-form" [autoDisplayFirst]="false">
                                    </p-dropdown>
                                </span>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="pantalla == 'JE' && permisoEscritura" class="right col-lg-12 col-md-6 ajustar marginButtons">
        <div class="inline-block text-right main-button setPosition">
            <button [disabled]="selectedArray.length == 0 || !permiteDescargarFicheros" (click)="download()" pButton
                type="button" icon="fa fa-download" iconPos="left"
                label="{{ 'agenda.fichaEventos.datosAsistencia.descargar' | translate}}">
            </button>

            <p-fileUpload #pUploadFile name="file"
                [disabled]="(selectedArray.length == 0 || selectedArray.length > 1) || !permiteAdjuntarFicheros"
                mode="basic" accept=".doc,.docx,.pdf,.jpg,.png,.rtf,.txt"
                chooseLabel="{{ 'general.boton.adjuntarFichero' | translate }}" class="edit my-0 mx-auto main-button"
                auto="true" [customUpload]="true" (uploadHandler)="uploadFile($event, pUploadFile)"></p-fileUpload>

            <button [disabled]="disableDelete == true || isLetrado" pButton type="button" icon="fa fa-trash-alt"
                iconPos="left" label="Eliminar" (click)="eliminar()">
            </button>

            <button [hidden]="isLetrado" pButton type="button" icon="fa fa-comment" iconPos="left" label="Comunicar"
                (click)="navigateComunicar()">
            </button>

            <button [hidden]="isLetrado" pButton type="button" icon="fa fa-comment" iconPos="left" label="Imprimir"
                (click)="navigateImprimir()">
            </button>

            <button [disabled]="isLetrado" pButton type="button" icon="far fa-save" iconPos="left" label="Guardar"
                (click)="comprobarDatosActuaciones()">
            </button>
            <button pButton [disabled]="selectedArray.length != 1 || !permisosFichaAct || isLetrado || comprobarCamposVacios()" type="button"
                icon="fa fa-plus" iconPos="left" label="Nuevo" (click)="newFromSelected()">
            </button>
        </div>
    </div>
    <p-confirmDialog header="{{ 'general.cabecera.confirmacion' | translate}}" key="deletePlantillaDoc" icon="icon"
        width="425" #deletePlantillaDoc>
        <p-footer>
            <button type="button" pButton icon="fa-check" label="OK" (click)="deletePlantillaDoc.accept()"></button>
            <button type="button" pButton icon="fa-close" label="Cancel" (click)="deletePlantillaDoc.reject()"></button>
        </p-footer>
    </p-confirmDialog>
    <div *ngIf="progressSpinner" class="overlay-spinner">
        <div class="loader"></div>
    </div>